import{Q as f}from"./QMarkupTable.57b7b7ae.js";import{_ as P,O as r,P as d,Q as s,R as o,az as c,T as n,Y as w,Z as k,$ as C,ay as h,S as p,ax as V,U as m,J as g,V as b,W as y,aA as A}from"./index.248e54b0.js";import{d as S,e as v,f as u,g as Q}from"./format.ab99b20b.js";import{Q as B}from"./QBtnDropdown.861144b7.js";import{h as G,Q as _,a as N,b as z}from"./moment.106bacac.js";import{Q as E,a as I}from"./QForm.3f39d0dd.js";import{Q as U}from"./QPage.3e0e6402.js";import{C as x}from"./ClosePopup.4c1f6cde.js";const Y={name:"AlmacenPage",data(){return{poas:[],poa:{},poaDialog:!1,loading:!1,actionPeriodo:"",peridosActivos:[],filter:"",columns:[{name:"actions",label:"Acciones",align:"center"},{name:"fecha",label:"Fecha",align:"center",field:e=>G(e.fecha).format("DD/MM/YYYY")},{name:"estado",label:"Estado",align:"center",field:e=>e.estado},{name:"periodo",label:"Periodo",align:"center",field:e=>e.periodo.periodo},{name:"area",label:"Area",align:"center",field:e=>{var a;return(a=e.area)==null?void 0:a.nombre}},{name:"user",label:"Usuario",align:"center",field:e=>{var a;return(a=e.user)==null?void 0:a.name}}]}},mounted(){this.poasGet(),this.periodosActivos()},methods:{periodosActivos(){this.$axios.get("periodos/activos").then(e=>{this.peridosActivos=e.data}).catch(e=>{this.$alert.error(e.response.data.message)})},poaNew(){this.poa={periodo_id:""},this.actionPeriodo="Nuevo",this.poaDialog=!0},poasGet(){this.loading=!0,this.$axios.get("poas").then(e=>{this.poas=e.data}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},poaPost(){this.loading=!0,this.$axios.post("poas",this.poa).then(e=>{this.poasGet(),this.poaDialog=!1,this.$alert.success("Periodo creado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},poaPut(){this.loading=!0,this.$axios.put("poas/"+this.poa.id,this.poa).then(e=>{this.poasGet(),this.poaDialog=!1,this.$alert.success("Periodo actualizado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},poaEdit(e){this.poa={...e},this.actionPeriodo="Editar",this.poaDialog=!0},poaVisible(e){this.$router.push({name:"poaVisible",params:{id:e.id}})},poaDelete(e){this.$alert.dialog("\xBFDesea eliminar el poa?").onOk(()=>{this.loading=!0,this.$axios.delete("poas/"+e).then(a=>{this.poasGet(),this.$alert.success("Periodo eliminado")}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})})}}},q={class:"row"},T={class:"col-12 col-md-6"},F={class:"text-right"};function L(e,a,O,M,i,t){return r(),d(U,{class:"q-pa-md"},{default:s(()=>[o(h,{flat:"",bordered:""},{default:s(()=>[o(c,{class:""},{default:s(()=>[n("div",q,[n("div",T,[a[6]||(a[6]=n("span",{class:"text-bold"},"Gestiones Activas:",-1)),(r(!0),w(C,null,k(i.peridosActivos,l=>(r(),d(f,{key:l.id,label:l.periodo,color:"positive",dense:"",size:"14px","text-color":"white"},null,8,["label"]))),128))])])]),_:1})]),_:1}),o(N,{rows:i.poas,columns:i.columns,dense:"","wrap-cells":"",flat:"",bordered:"","rows-per-page-options":[0],title:"Almacen",filter:i.filter},{"top-right":s(()=>[o(p,{color:"primary",label:"Crear poa",onClick:t.poaNew,"no-caps":"",icon:"add_circle_outline",loading:i.loading},null,8,["onClick","loading"]),o(V,{modelValue:i.filter,"onUpdate:modelValue":a[0]||(a[0]=l=>i.filter=l),label:"Buscar",dense:"",outlined:""},{append:s(()=>[o(m,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":s(l=>[o(_,{props:l},{default:s(()=>[o(B,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:s(()=>[o(S,null,{default:s(()=>[g((r(),d(v,{clickable:"",onClick:D=>t.poaVisible(l.row)},{default:s(()=>[o(u,{avatar:""},{default:s(()=>[o(m,{name:"visibility"})]),_:1}),o(u,null,{default:s(()=>[o(Q,null,{default:s(()=>a[7]||(a[7]=[b("Administrar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[x]]),g((r(),d(v,{clickable:"",onClick:D=>t.poaDelete(l.row.id)},{default:s(()=>[o(u,{avatar:""},{default:s(()=>[o(m,{name:"delete"})]),_:1}),o(u,null,{default:s(()=>[o(Q,null,{default:s(()=>a[8]||(a[8]=[b("Eliminar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[x]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-estado":s(l=>[o(_,{props:l},{default:s(()=>[o(f,{label:l.row.estado,color:l.row.estado==="Abierto"?"positive":"red","text-color":"white",dense:"",size:"14px"},null,8,["label","color"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),o(A,{modelValue:i.poaDialog,"onUpdate:modelValue":a[5]||(a[5]=l=>i.poaDialog=l),persistent:""},{default:s(()=>[o(h,null,{default:s(()=>[o(c,{class:"q-pb-none row items-center"},{default:s(()=>[n("div",null,y(i.actionPeriodo)+" poa ",1),o(E),o(p,{icon:"close",flat:"",round:"",dense:"",onClick:a[1]||(a[1]=l=>i.poaDialog=!1)})]),_:1}),o(c,{class:"q-pt-none"},{default:s(()=>[o(I,{onSubmit:a[4]||(a[4]=l=>i.poa.id?t.poaPut():t.poaPost())},{default:s(()=>[o(z,{modelValue:i.poa.periodo_id,"onUpdate:modelValue":a[2]||(a[2]=l=>i.poa.periodo_id=l),label:"Periodo",outlined:"",dense:"",options:i.peridosActivos,rules:[l=>!!l||"Seleccione un periodo"],"emit-value":"","map-options":"","option-label":l=>l.periodo,"option-value":l=>l.id},null,8,["modelValue","options","rules","option-label","option-value"]),n("div",F,[o(p,{color:"negative",label:"Cancelar",onClick:a[3]||(a[3]=l=>i.poaDialog=!1),"no-caps":"",loading:i.loading},null,8,["loading"]),o(p,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:i.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var X=P(Y,[["render",L]]);export{X as default};
