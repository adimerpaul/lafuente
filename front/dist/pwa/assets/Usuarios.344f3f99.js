import{_ as v,B as n,C as u,E as r,F as e,Q as m,aE as d,I as p,x as c,J as g,aF as P,aG as V,G as w,H as x,R as D,aH as y}from"./index.b06572a0.js";import{a as h,b as i,c as b}from"./QMenu.c1e63efd.js";import{Q as U}from"./QList.fb2aa972.js";import{Q as _}from"./QBtnDropdown.af88a833.js";import{Q as k,a as E}from"./QTable.1fff7f3f.js";import{Q as N}from"./QChip.cff6d88d.js";import{Q as G}from"./QSpace.d75b8165.js";import{Q as q}from"./QSelect.22ca404a.js";import{Q as B}from"./QForm.e993d99a.js";import{Q as I}from"./QPage.a459216a.js";import{C as Q}from"./ClosePopup.160a1389.js";import"./moment.40bc58bf.js";import"./selection.4897e411.js";import"./QBtnGroup.2aca49b6.js";import"./QMarkupTable.8b056a53.js";import"./format.2cae61da.js";const S={name:"UsuariosPage",data(){return{users:[],user:{},userDialog:!1,loading:!1,actionPeriodo:"",gestiones:[],filter:"",roles:["Farmacia","Secretaria","Administrador"],columns:[{name:"actions",label:"Acciones",align:"center"},{name:"name",label:"Nombre",align:"left",field:"name"},{name:"username",label:"Usuario",align:"left",field:"username"},{name:"role",label:"Rol",align:"left",field:"role"},{name:"email",label:"Email",align:"left",field:"email"}]}},mounted(){this.usersGet()},methods:{userNew(){this.user={name:"",email:"",password:"",area_id:1,username:"",cargo:"",role:"Area"},this.actionPeriodo="Nuevo",this.userDialog=!0},usersGet(){this.loading=!0,this.$axios.get("users").then(o=>{this.users=o.data}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1})},gestionGet(){this.loading=!0,this.$axios.get("gestiones").then(o=>{this.gestiones=o.data,this.loading=!1}).catch(o=>{this.$alert.error(o.response.data.message),this.loading=!1})},userPost(){this.loading=!0,this.$axios.post("users",this.user).then(o=>{this.usersGet(),this.userDialog=!1,this.$alert.success("Periodo creado")}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1})},userPut(){this.loading=!0,this.$axios.put("users/"+this.user.id,this.user).then(o=>{this.usersGet(),this.userDialog=!1,this.$alert.success("Periodo actualizado")}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1})},userEditPassword(o){this.user={...o},this.$alert.dialogPrompt("Nueva contrase\xF1a","Ingrese la nueva contrase\xF1a","password").onOk(s=>{this.$axios.put("updatePassword/"+o.id,{password:s}).then(f=>{this.usersGet(),this.$alert.success("Contrase\xF1a actualizada")}).catch(f=>{this.$alert.error(f.response.data.message)})})},userEdit(o){this.user={...o},this.actionPeriodo="Editar",this.userDialog=!0},userDelete(o){this.$alert.dialog("\xBFDesea eliminar el user?").onOk(()=>{this.loading=!0,this.$axios.delete("users/"+o).then(s=>{this.usersGet(),this.$alert.success("Periodo eliminado")}).catch(s=>{this.$alert.error(s.response.data.message)}).finally(()=>{this.loading=!1})})}}},z={class:"text-right"};function F(o,s,f,A,a,t){return n(),u(I,{class:"q-pa-md"},{default:r(()=>[e(E,{rows:a.users,columns:a.columns,dense:"","wrap-cells":"",flat:"",bordered:"","rows-per-page-options":[0],title:"Usuarios",filter:a.filter},{"top-right":r(()=>[e(m,{color:"primary",label:"Nuevo",onClick:t.userNew,outline:"","no-caps":"",icon:"add_circle_outline",loading:a.loading},null,8,["onClick","loading"]),e(d,{modelValue:a.filter,"onUpdate:modelValue":s[0]||(s[0]=l=>a.filter=l),label:"Buscar",dense:"",outlined:""},{append:r(()=>[e(p,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":r(l=>[e(k,{props:l},{default:r(()=>[e(_,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:r(()=>[e(U,null,{default:r(()=>[c((n(),u(h,{clickable:"",onClick:C=>t.userEdit(l.row)},{default:r(()=>[e(i,{avatar:""},{default:r(()=>[e(p,{name:"edit"})]),_:1}),e(i,null,{default:r(()=>[e(b,null,{default:r(()=>s[10]||(s[10]=[g("Editar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[Q]]),c((n(),u(h,{clickable:"",onClick:C=>t.userDelete(l.row.id)},{default:r(()=>[e(i,{avatar:""},{default:r(()=>[e(p,{name:"delete"})]),_:1}),e(i,null,{default:r(()=>[e(b,null,{default:r(()=>s[11]||(s[11]=[g("Eliminar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[Q]]),c((n(),u(h,{clickable:"",onClick:C=>t.userEditPassword(l.row)},{default:r(()=>[e(i,{avatar:""},{default:r(()=>[e(p,{name:"edit"})]),_:1}),e(i,null,{default:r(()=>[e(b,null,{default:r(()=>s[12]||(s[12]=[g("Cambiar contrase\xF1a")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[Q]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-role":r(l=>[e(k,{props:l},{default:r(()=>[e(N,{label:l.row.role,color:l.row.color,"text-color":"white",dense:"",size:"14px"},null,8,["label","color"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),e(y,{modelValue:a.userDialog,"onUpdate:modelValue":s[9]||(s[9]=l=>a.userDialog=l),persistent:""},{default:r(()=>[e(P,null,{default:r(()=>[e(V,{class:"q-pb-none row items-center"},{default:r(()=>[w("div",null,x(a.actionPeriodo)+" user ",1),e(G),e(m,{icon:"close",flat:"",round:"",dense:"",onClick:s[1]||(s[1]=l=>a.userDialog=!1)})]),_:1}),e(V,{class:"q-pt-none"},{default:r(()=>[e(B,{onSubmit:s[8]||(s[8]=l=>a.user.id?t.userPut():t.userPost())},{default:r(()=>[e(d,{modelValue:a.user.name,"onUpdate:modelValue":s[2]||(s[2]=l=>a.user.name=l),label:"Nombre",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"]),e(d,{modelValue:a.user.username,"onUpdate:modelValue":s[3]||(s[3]=l=>a.user.username=l),label:"Usuario",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"]),e(d,{modelValue:a.user.email,"onUpdate:modelValue":s[4]||(s[4]=l=>a.user.email=l),label:"Email",dense:"",outlined:"",hint:""},null,8,["modelValue"]),a.user.id?D("",!0):(n(),u(d,{key:0,modelValue:a.user.password,"onUpdate:modelValue":s[5]||(s[5]=l=>a.user.password=l),label:"Contrase\xF1a",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])),e(q,{modelValue:a.user.role,"onUpdate:modelValue":s[6]||(s[6]=l=>a.user.role=l),label:"Rol",dense:"",outlined:"",options:a.roles,rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","options","rules"]),w("div",z,[e(m,{color:"negative",label:"Cancelar",onClick:s[7]||(s[7]=l=>a.userDialog=!1),"no-caps":"",loading:a.loading},null,8,["loading"]),e(m,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:a.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var se=v(S,[["render",F]]);export{se as default};
