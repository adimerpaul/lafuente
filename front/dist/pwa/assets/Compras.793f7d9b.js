import{_ as q,O as p,X as b,R as e,Q as a,T as t,Z as Q,aG as _,aH as v,$ as f,V as r,U as i,aF as k,S as x,Y as B,J as w,P as F}from"./index.8cfd3fd6.js";import{a as h,b as d}from"./QMenu.99a3e082.js";import{Q as m}from"./QItemLabel.9a064e5c.js";import{Q as D}from"./QSelect.2db691c3.js";import{Q as A}from"./QBtnDropdown.db6ee299.js";import{Q as I}from"./QChip.01d1f48e.js";import{Q as E}from"./QMarkupTable.eee695c5.js";import{Q as Y}from"./QPage.9d9eacf3.js";import{C as y}from"./ClosePopup.cc23ecb4.js";import{h as T}from"./moment.40bc58bf.js";import{I as G}from"./Imprimir.3322c09e.js";import{E as U}from"./Excel.a5e16faf.js";import"./format.2cae61da.js";import"./QBtnGroup.e2b7a551.js";import"./_commonjsHelpers.a26ce4be.js";const P={data(){return{compras:[],fechaInicio:T().format("YYYY-MM-DD"),fechaFin:T().format("YYYY-MM-DD"),user:"",users:[],loading:!1}},mounted(){this.comprasGet(),this.usersGet()},computed:{usersTodos(){return[{label:"Todos",value:""},...this.users.map(o=>({label:o.name,value:o.id}))]},totalCompras(){return this.compras.reduce((o,l)=>l.estado==="Activo"?o+parseFloat(l.total):o,0).toFixed(2)},totalAnuladas(){return this.compras.reduce((o,l)=>l.estado==="Anulado"?o+parseFloat(l.total):o,0).toFixed(2)}},methods:{excel(){const o=[{columns:[{label:"ID",value:"id"},{label:"Fecha",value:l=>`${l.fecha} ${l.hora}`},{label:"Proveedor",value:l=>{var u;return((u=l.proveedor)==null?void 0:u.nombre)||l.nombre||""}},{label:"Usuario",value:l=>{var u;return((u=l.user)==null?void 0:u.name)||""}},{label:"Estado",value:"estado"},{label:"Total (Bs)",value:"total"},{label:"Detalle",value:"detailsText"},{label:"Tipo de pago",value:"tipo_pago"},{label:"Factura",value:"nro_factura"}],content:this.compras}];U.export(o,`Compras_${this.fechaInicio}_a_${this.fechaFin}`)},comprasGet(){this.loading=!0,this.$axios.get("compras",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,user:this.user}}).then(o=>{this.compras=o.data}).catch(o=>{var l,u;this.$alert.error(((u=(l=o.response)==null?void 0:l.data)==null?void 0:u.message)||"Error al obtener compras")}).finally(()=>{this.loading=!1})},usersGet(){this.$axios.get("users").then(o=>{console.log(o.data),this.users=o.data})},imprimir(o){G.reciboCompra(o)},anular(o){this.$alert.dialog("\xBFAnular esta compra?").onOk(()=>{this.loading=!0,this.$axios.put(`comprasAnular/${o}`).then(()=>{this.$alert.success("Compra anulada"),this.comprasGet()})})}}},M={class:"row"},S={class:"col-12 col-md-4 q-pa-xs"},z={class:"col-12 col-md-4 q-pa-xs"},N={class:"col-12 col-md-4 q-pa-xs"},O={class:"row q-col-gutter-sm q-pa-sm"},L={class:"col-12 col-md-2"},$={class:"col-12 col-md-2"},H={class:"col-12 col-md-2"},J={class:"col-12 col-md-2"},R={class:"col-12 col-md-2"},X={class:"col-12 col-md-2"},Z={class:"text-bold"},j={style:{"max-width":"200px","line-height":"1.1"}};function K(o,l,u,W,n,c){return p(),b(Q,null,[e(Y,{class:"q-pa-xs"},{default:a(()=>[t("div",M,[t("div",S,[e(_,{flat:"",bordered:""},{default:a(()=>[e(v,{class:"q-pa-none"},{default:a(()=>[e(h,{class:"bg-green"},{default:a(()=>[e(d,{avatar:""},{default:a(()=>[e(f,{name:"inventory_2",size:"50px",color:"white"})]),_:1}),e(d,null,{default:a(()=>[e(m,{caption:"",class:"text-white"},{default:a(()=>l[4]||(l[4]=[r("Compras Totales")])),_:1}),e(m,{class:"text-white text-h4"},{default:a(()=>[r(i(c.totalCompras)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),t("div",z,[e(_,{flat:"",bordered:""},{default:a(()=>[e(v,{class:"q-pa-none"},{default:a(()=>[e(h,{class:"bg-negative"},{default:a(()=>[e(d,{avatar:""},{default:a(()=>[e(f,{name:"cancel",size:"50px",color:"white"})]),_:1}),e(d,null,{default:a(()=>[e(m,{caption:"",class:"text-white"},{default:a(()=>l[5]||(l[5]=[r("Compras Anuladas")])),_:1}),e(m,{class:"text-white text-h4"},{default:a(()=>[r(i(c.totalAnuladas)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),t("div",N,[e(_,{flat:"",bordered:""},{default:a(()=>[e(v,{class:"q-pa-none"},{default:a(()=>[e(h,{class:"bg-indigo"},{default:a(()=>[e(d,{avatar:""},{default:a(()=>[e(f,{name:"inventory_2",size:"50px",color:"white"})]),_:1}),e(d,null,{default:a(()=>[e(m,{caption:"",class:"text-white"},{default:a(()=>l[6]||(l[6]=[r("Total Compras")])),_:1}),e(m,{class:"text-white text-h4"},{default:a(()=>[r(i(n.compras.length),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),e(_,{flat:"",bordered:"",class:"q-mt-sm"},{default:a(()=>[e(v,{class:"q-pa-none"},{default:a(()=>[t("div",O,[t("div",L,[e(k,{modelValue:n.fechaInicio,"onUpdate:modelValue":l[0]||(l[0]=s=>n.fechaInicio=s),label:"Fecha inicio",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),t("div",$,[e(k,{modelValue:n.fechaFin,"onUpdate:modelValue":l[1]||(l[1]=s=>n.fechaFin=s),label:"Fecha fin",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),t("div",H,[e(D,{modelValue:n.user,"onUpdate:modelValue":l[2]||(l[2]=s=>n.user=s),options:c.usersTodos,label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),t("div",J,[e(x,{color:"primary",label:"Buscar",icon:"search",onClick:c.comprasGet,loading:n.loading,"no-caps":""},null,8,["onClick","loading"])]),t("div",R,[e(x,{color:"positive",label:"Compra",icon:"add_circle_outline",onClick:l[3]||(l[3]=s=>o.$router.push({name:"compras-create"})),"no-caps":"",loading:n.loading},null,8,["loading"])]),t("div",X,[e(x,{color:"primary",label:"Excel",icon:"file_download",onClick:c.excel,"no-caps":"",loading:n.loading},null,8,["onClick","loading"])])])]),_:1})]),_:1}),e(E,{dense:"","wrap-cells":""},{default:a(()=>[l[9]||(l[9]=t("thead",null,[t("tr",{class:"bg-primary text-white"},[t("th",null,"Acciones"),t("th",null,"ID"),t("th",null,"Fecha"),t("th",null,"Proveedor"),t("th",null,"Usuario"),t("th",null,"Estado"),t("th",null,"Total"),t("th",null,"Detalle"),t("th",null,"Pago")])],-1)),t("tbody",null,[(p(!0),b(Q,null,B(n.compras,s=>{var g,C;return p(),b("tr",{key:s.id},[t("td",null,[e(A,{color:"primary",label:"Opciones","no-caps":"",dense:"",size:"10px"},{default:a(()=>[w((p(),F(h,{clickable:"",onClick:V=>c.imprimir(s)},{default:a(()=>[e(d,{avatar:""},{default:a(()=>[e(f,{name:"print"})]),_:1}),e(d,null,{default:a(()=>l[7]||(l[7]=[r("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[y]]),w((p(),F(h,{clickable:"",onClick:V=>c.anular(s.id)},{default:a(()=>[e(d,{avatar:""},{default:a(()=>[e(f,{name:"delete"})]),_:1}),e(d,null,{default:a(()=>l[8]||(l[8]=[r("Anular")])),_:1})]),_:2},1032,["onClick"])),[[y]])]),_:2},1024)]),t("td",null,i(s.id),1),t("td",null,i(s.fecha)+" "+i(s.hora),1),t("td",null,i((g=s.proveedor)==null?void 0:g.nombre),1),t("td",null,i((C=s.user)==null?void 0:C.name),1),t("td",null,[e(I,{color:s.estado==="Activo"?"positive":"negative",class:"text-white",dense:""},{default:a(()=>[r(i(s.estado),1)]),_:2},1032,["color"])]),t("td",Z,i(s.total)+" Bs",1),t("td",null,[t("div",j,i(s.detailsText),1)]),t("td",null,[e(I,{color:s.tipo_pago==="Efectivo"?"green":"blue",class:"text-white",dense:""},{default:a(()=>[r(i(s.tipo_pago),1)]),_:2},1032,["color"])])])}),128))])]),_:1})]),_:1}),l[10]||(l[10]=t("div",{id:"myElement",class:"hidden"},null,-1))],64)}var he=q(P,[["render",K]]);export{he as default};
