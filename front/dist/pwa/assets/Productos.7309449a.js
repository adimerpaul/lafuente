import{_ as E,aY as F,O as n,P as b,Q as s,R as l,aH as h,T as i,S as p,aF as m,$ as k,X as c,Y as _,Z as D,aG as y,U as r,aI as Q,V as x,a2 as q,J as V,bd as G}from"./index.9cf1c715.js";import{Q as I}from"./QPagination.567d54be.js";import{a as v,b as g,d as w}from"./QMenu.e85fda1c.js";import{Q as H}from"./QList.a3721ed1.js";import{Q as B}from"./QBtnDropdown.777be126.js";import{Q as z}from"./QImg.a3b9f58a.js";import{Q as N}from"./QMarkupTable.279e636a.js";import{Q as S}from"./QSpace.42bb93e0.js";import{Q as T}from"./QForm.ca02f0d8.js";import{Q as L}from"./QPage.8461fa7a.js";import{C}from"./ClosePopup.49cd185d.js";import"./moment.40bc58bf.js";import{E as O}from"./Excel.1dde0077.js";import"./format.2cae61da.js";import"./QBtnGroup.4c6beec5.js";import"./_commonjsHelpers.a26ce4be.js";const M={name:"ProductosPage",data(){return{productos:[],producto:{},productoDialog:!1,loading:!1,actionPeriodo:"",filter:"",pagination:{page:1,rowsPerPage:15,rowsNumber:0},columns:[{name:"nombre",label:"Nombre",align:"left",field:"nombre"},{name:"descripcion",label:"Descripci\xF3n",align:"left",field:"descripcion"},{name:"unidad",label:"Unidad",align:"left",field:"unidad"},{name:"precio",label:"Precio",align:"left",field:"precio"},{name:"stock",label:"Stock",align:"left",field:"stock"},{name:"stock_minimo",label:"Stock m\xEDnimo",align:"left",field:"stock_minimo"},{name:"stock_maximo",label:"Stock m\xE1ximo",align:"left",field:"stock_maximo"}],historialDialog:!1,historialCompras:[],productoHistorialNombre:"",dialogFoto:!1}},mounted(){this.productosGet(),this.debouncedCambioPrecio=F(this.cambioPrecio,500),this.debouncedCambioStock=F(this.cambioStock,500)},methods:{onFileChange(a){const e=a.target.files[0];if(e){const f=new FormData;f.append("file",e),this.loading=!0,this.$axios.post(`productos/${this.producto.id}/foto`,f,{headers:{"Content-Type":"multipart/form-data"}}).then(P=>{this.productosGet(),this.$alert.success("Foto actualizada"),this.dialogFoto=!1}).catch(P=>{this.$alert.error(P.response.data.message)}).finally(()=>{this.loading=!1})}},productoEditFoto(a){this.dialogFoto=!0,this.producto={...a}},verHistorial(a){this.loading=!0,this.productoHistorialNombre=a.nombre,this.$axios.get(`productos/${a.id}/historial-compras`).then(e=>{this.historialCompras=e.data,this.historialDialog=!0}).catch(e=>{this.$alert.error("Error al obtener historial")}).finally(()=>{this.loading=!1})},cambioStock(a){this.loading=!0,this.$axios.put("productos/"+a.id,{stock:a.stock}).then(e=>{this.productosGet(),this.$alert.success("Stock actualizado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},cambioPrecio(a){this.loading=!0,this.$axios.put("productos/"+a.id,{precio:a.precio}).then(e=>{this.productosGet(),this.$alert.success("Precio actualizado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})},exportExcel(){this.loading=!0,this.$axios.get("productosAll").then(a=>{let e=[{columns:[{label:"Nombre",value:"nombre"},{label:"Descripci\xF3n",value:"descripcion"},{label:"Unidad",value:"unidad"},{label:"Precio",value:"precio"},{label:"Stock",value:"stock"},{label:"Stock m\xEDnimo",value:"stock_minimo"},{label:"Stock m\xE1ximo",value:"stock_maximo"}],content:a.data}];O.export(e,"Productos")}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},productoNew(){this.producto={name:"",email:"",password:"",area_id:1,productoname:"",cargo:"",role:"Area"},this.actionPeriodo="Nuevo",this.productoDialog=!0},productosGet(){this.loading=!0,this.$axios.get("productos",{params:{search:this.filter,page:this.pagination.page,per_page:this.pagination.rowsPerPage}}).then(a=>{this.productos=a.data.data,this.pagination.rowsNumber=a.data.total}).catch(a=>{var e,f;this.$alert.error(((f=(e=a.response)==null?void 0:e.data)==null?void 0:f.message)||"Error al cargar productos")}).finally(()=>{this.loading=!1})},gestionGet(){this.loading=!0,this.$axios.get("gestiones").then(a=>{this.gestiones=a.data,this.loading=!1}).catch(a=>{this.$alert.error(a.response.data.message),this.loading=!1})},productoPost(){this.loading=!0,this.$axios.post("productos",this.producto).then(a=>{this.productosGet(),this.productoDialog=!1,this.$alert.success("Periodo creado")}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},productoPut(){this.loading=!0,this.$axios.put("productos/"+this.producto.id,this.producto).then(a=>{this.productosGet(),this.productoDialog=!1,this.$alert.success("Periodo actualizado")}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},productoEdit(a){this.producto={...a},this.actionPeriodo="Editar",this.productoDialog=!0},productoDelete(a){this.$alert.dialog("\xBFDesea eliminar el producto?").onOk(()=>{this.loading=!0,this.$axios.delete("productos/"+a).then(e=>{this.productosGet(),this.$alert.success("Periodo eliminado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})})}}},A={class:"text-right"},K={class:"flex flex-center"},Y={style:{"max-width":"150px","wrap-option":"wrap","line-height":"0.9"}},J={style:{"max-width":"200px","wrap-option":"wrap","line-height":"0.9"}},R={style:{"max-width":"80px","wrap-option":"wrap","line-height":"0.9"}},X=["onUpdate:modelValue","onKeyup"],Z={key:0},j={key:1,class:"text-grey"},W={class:"text-right"},$={class:"text-h6"},ee=["src"];function oe(a,e,f,P,t,d){return n(),b(L,{class:"q-pa-xs"},{default:s(()=>[l(y,{flat:"",bordered:""},{default:s(()=>[l(h,{class:"q-pa-xs"},{default:s(()=>[i("div",A,[l(p,{color:"primary",label:"Descargar","no-caps":"",icon:"fa-solid fa-file-excel",loading:t.loading,onClick:d.exportExcel},null,8,["loading","onClick"]),l(p,{color:"green",label:"Nuevo",onClick:d.productoNew,"no-caps":"",icon:"add_circle_outline",loading:t.loading},null,8,["onClick","loading"]),l(m,{modelValue:t.filter,"onUpdate:modelValue":[e[0]||(e[0]=o=>t.filter=o),d.productosGet],label:"Buscar",dense:"",outlined:"",debounce:"300"},{append:s(()=>[l(k,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),i("div",K,[l(I,{modelValue:t.pagination.page,"onUpdate:modelValue":[e[1]||(e[1]=o=>t.pagination.page=o),d.productosGet],max:Math.ceil(t.pagination.rowsNumber/t.pagination.rowsPerPage),"rows-per-page-options":[10,25,50,100],"rows-per-page":t.pagination.rowsPerPage,"rows-number":t.pagination.rowsNumber,color:"primary","boundary-numbers":"","max-pages":"5"},null,8,["modelValue","max","rows-per-page","rows-number","onUpdate:modelValue"])]),l(N,{dense:"","wrap-cells":""},{default:s(()=>[i("thead",null,[i("tr",null,[e[19]||(e[19]=i("th",null,"Opciones",-1)),e[20]||(e[20]=i("th",null,"Imagen",-1)),(n(!0),c(D,null,_(t.columns,o=>(n(),c("th",{key:o.name,class:q(o.align)},r(o.label),3))),128))])]),i("tbody",null,[(n(!0),c(D,null,_(t.productos,o=>(n(),c("tr",{key:o.id},[i("td",null,[l(B,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:s(()=>[l(H,null,{default:s(()=>[V((n(),b(v,{clickable:"",onClick:u=>d.productoEdit(o)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(k,{name:"edit"})]),_:1}),l(g,null,{default:s(()=>[l(w,null,{default:s(()=>e[21]||(e[21]=[x("Editar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[C]]),V((n(),b(v,{clickable:"",onClick:u=>d.productoDelete(o.id)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(k,{name:"delete"})]),_:1}),l(g,null,{default:s(()=>[l(w,null,{default:s(()=>e[22]||(e[22]=[x("Eliminar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[C]]),V((n(),b(v,{clickable:"",onClick:u=>d.verHistorial(o)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(k,{name:"history"})]),_:1}),l(g,null,{default:s(()=>[l(w,null,{default:s(()=>e[23]||(e[23]=[x("Historial de compras")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[C]]),V((n(),b(v,{clickable:"",onClick:u=>d.productoEditFoto(o)},{default:s(()=>[l(g,{avatar:""},{default:s(()=>[l(k,{name:"photo"})]),_:1}),l(g,null,{default:s(()=>[l(w,null,{default:s(()=>e[24]||(e[24]=[x("Ver foto")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[C]])]),_:2},1024)]),_:2},1024)]),i("td",null,[l(z,{src:`${a.$url}../images/${o.imagen}`,style:{width:"50px",height:"50px"},class:"q-mr-sm"},null,8,["src"])]),i("td",null,[i("div",Y,r(o.nombre),1)]),i("td",null,[i("div",J,r(o.descripcion),1)]),i("td",null,[i("div",R,r(o.unidad),1)]),i("td",null,[V(i("input",{"onUpdate:modelValue":u=>o.precio=u,type:"number",step:"0.01",min:"0",style:{width:"60px","text-align":"right"},onKeyup:u=>a.debouncedCambioPrecio(o)},null,40,X),[[G,o.precio,void 0,{number:!0}]])]),i("td",null,[o.stock!==null?(n(),c("div",Z,r(o.cantidad),1)):(n(),c("div",j,"-"))]),i("td",null,r(o.stock_minimo),1),i("td",null,r(o.stock_maximo),1)]))),128))])]),_:1})]),_:1})]),_:1}),l(Q,{modelValue:t.productoDialog,"onUpdate:modelValue":e[12]||(e[12]=o=>t.productoDialog=o),persistent:""},{default:s(()=>[l(y,{style:{width:"400px",margin:"0 auto"}},{default:s(()=>[l(h,{class:"q-pb-none row items-center"},{default:s(()=>[i("div",null,r(t.actionPeriodo)+" producto ",1),l(S),l(p,{icon:"close",flat:"",round:"",dense:"",onClick:e[2]||(e[2]=o=>t.productoDialog=!1)})]),_:1}),l(h,{class:"q-pt-none"},{default:s(()=>[l(T,{onSubmit:e[11]||(e[11]=o=>t.producto.id?d.productoPut():d.productoPost())},{default:s(()=>[l(m,{modelValue:t.producto.nombre,"onUpdate:modelValue":e[3]||(e[3]=o=>t.producto.nombre=o),label:"Nombre",dense:"",outlined:"",rules:[o=>!!o||"Campo requerido"]},null,8,["modelValue","rules"]),l(m,{modelValue:t.producto.descripcion,"onUpdate:modelValue":e[4]||(e[4]=o=>t.producto.descripcion=o),label:"Descripci\xF3n",dense:"",outlined:"",hint:""},null,8,["modelValue"]),l(m,{modelValue:t.producto.unidad,"onUpdate:modelValue":e[5]||(e[5]=o=>t.producto.unidad=o),label:"Unidad",dense:"",outlined:"",hint:""},null,8,["modelValue"]),l(m,{modelValue:t.producto.precio,"onUpdate:modelValue":e[6]||(e[6]=o=>t.producto.precio=o),label:"Precio",dense:"",outlined:"",hint:"",type:"number",step:"0.01"},null,8,["modelValue"]),l(m,{modelValue:t.producto.stock,"onUpdate:modelValue":e[7]||(e[7]=o=>t.producto.stock=o),label:"Stock",dense:"",outlined:"",hint:""},null,8,["modelValue"]),l(m,{modelValue:t.producto.stock_minimo,"onUpdate:modelValue":e[8]||(e[8]=o=>t.producto.stock_minimo=o),label:"Stock m\xEDnimo",dense:"",outlined:"",hint:""},null,8,["modelValue"]),l(m,{modelValue:t.producto.stock_maximo,"onUpdate:modelValue":e[9]||(e[9]=o=>t.producto.stock_maximo=o),label:"Stock m\xE1ximo",dense:"",outlined:"",hint:""},null,8,["modelValue"]),i("div",W,[l(p,{color:"negative",label:"Cancelar",onClick:e[10]||(e[10]=o=>t.productoDialog=!1),"no-caps":"",loading:t.loading},null,8,["loading"]),l(p,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:t.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Q,{modelValue:t.historialDialog,"onUpdate:modelValue":e[14]||(e[14]=o=>t.historialDialog=o),persistent:""},{default:s(()=>[l(y,{style:{width:"800px"}},{default:s(()=>[l(h,{class:"row items-center q-pb-none"},{default:s(()=>[i("div",$,"Historial de Compras: "+r(t.productoHistorialNombre),1),l(S),l(p,{icon:"close",flat:"",round:"",dense:"",onClick:e[13]||(e[13]=o=>t.historialDialog=!1)})]),_:1}),l(h,{class:"q-pt-none"},{default:s(()=>[l(N,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:s(()=>[e[25]||(e[25]=i("thead",null,[i("tr",null,[i("th",null,"#"),i("th",null,"Fecha"),i("th",null,"Lote"),i("th",null,"Vencimiento"),i("th",null,"Cantidad"),i("th",null,"Precio"),i("th",null,"Total")])],-1)),i("tbody",null,[(n(!0),c(D,null,_(t.historialCompras,(o,u)=>{var U;return n(),c("tr",{key:o.id},[i("td",null,r(u+1),1),i("td",null,r((U=o.compra)==null?void 0:U.fecha),1),i("td",null,r(o.lote),1),i("td",null,r(o.fecha_vencimiento),1),i("td",null,r(o.cantidad),1),i("td",null,r(o.precio),1),i("td",null,r(o.total),1)])}),128))])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Q,{modelValue:t.dialogFoto,"onUpdate:modelValue":e[18]||(e[18]=o=>t.dialogFoto=o)},{default:s(()=>[l(y,{style:{width:"400px"}},{default:s(()=>[l(h,{class:"q-pb-none text-bold row items-center"},{default:s(()=>[x(" Cambiar foto de producto "+r(t.producto.nombre)+" ",1),l(S),l(p,{icon:"close",flat:"",round:"",dense:"",onClick:e[15]||(e[15]=o=>t.dialogFoto=!1)})]),_:1}),l(h,{class:"row items-center q-pb-none"},{default:s(()=>[l(p,{label:"Subir foto",color:"primary",onClick:e[16]||(e[16]=o=>a.$refs.fileInput.click()),class:"q-mr-sm","no-caps":"",dense:"",icon:"cloud_upload",loading:t.loading},null,8,["loading"]),i("input",{type:"file",ref:"fileInput",accept:"image/*",onChange:e[17]||(e[17]=(...o)=>d.onFileChange&&d.onFileChange(...o)),style:{display:"none"}},null,544),i("img",{src:`${a.$url}../images/${t.producto.imagen}`,style:{width:"350px",height:"350px"},class:"q-mr-sm"},null,8,ee)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var ke=E(M,[["render",oe]]);export{ke as default};
