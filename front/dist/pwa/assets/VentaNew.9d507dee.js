import{_ as Q,O as p,P as R,Q as a,R as s,aG as v,T as e,S as h,aE as _,Y as m,Z as b,$ as x,W as l,aF as k,J as V,bc as w,aH as D,U as q,V as B}from"./index.f1eec186.js";import{Q as y}from"./QMarkupTable.3dc6308c.js";import{Q as S}from"./QSpace.051ef0dd.js";import{Q as U}from"./QForm.b0b5263b.js";import{Q as C}from"./moment.52b1d089.js";import{Q as E}from"./QPage.2ad8f666.js";import{I as N}from"./Imprimir.d6d120e9.js";import"./format.04cc41f9.js";const I={name:"VentasNew",props:{},emits:["pacienteGet"],data(){return{loading:!1,paciente:{},ventaDialog:!1,efectivo:"",venta:{nit:"0",nombre:"SN"},recognition:null,activeField:null,productos:[],productosSearch:"",productosVentas:[],unidades:["","capsulas","comprimidos","pastillas","ml","mg","otro"],vias:["","oral","intramuscular","intravenosa","subcut\xE1nea","t\xF3pica","oft\xE1lmica","\xF3tica","nasal","rectal","vaginal"],frecuencias:["","cada 8 horas","cada 12 horas","cada 24 horas","cada 48 horas","cada 72 horas","cada 96 horas","cada 120 horas","cada 144 horas","cada 168 horas"],duraciones:["","3 dias","5 dias","7 dias","10 dias","14 dias","21 dias","28 dias","30 dias","60 dias","90 dias","120 dias","180 dias","240 dias","365 dias"]}},mounted(){if(this.productosGet(),"webkitSpeechRecognition"in window||"SpeechRecognition"in window){const i=window.SpeechRecognition||window.webkitSpeechRecognition;this.recognition=new i,this.recognition.lang="es-ES",this.recognition.interimResults=!1,this.recognition.continuous=!1,this.recognition.onresult=t=>{const d=t.results[0][0].transcript;this.activeField&&(this.venta[this.activeField]+=d)},this.recognition.onerror=t=>{console.error("Error en reconocimiento de voz:",t.error)}}else console.error("El reconocimiento de voz no est\xE1 soportado en este navegador")},methods:{searchCliente(){this.loading=!0,this.$axios.post("searchCliente",{nit:this.venta.nit}).then(i=>{this.loading=!1,i.data.nombre&&(this.venta.nombre=i.data.nombre)}).catch(i=>{this.loading=!1,console.error(i)})},clickDialogVenta(){if(this.productosVentas.length===0){this.$alert.error("Debe agregar al menos un producto a la venta");return}this.ventaDialog=!0,this.venta={nit:"0",nombre:"SN",tipo_venta:"Interno",tipo_pago:"Efectivo"},this.efectivo=""},recoveryReceta(){this.$alert.dialogPrompt("Numero de receta ",{title:"Recuperar receta",cancel:!0,persistent:!0}).onOk(i=>{this.loading=!0,this.$axios.get("receta/"+i).then(t=>{console.log(t.data);const d=t.data.receta_detalles;if(d.length===0){this.$alert.error("Receta vac\xEDa");return}this.productosVentas=d.filter(c=>c.producto_id).map(c=>(console.log(c),{producto_id:c.producto_id,cantidad:c.cantidad,precio:c.producto.precio,producto:c.producto}))}).catch(t=>{this.$alert.error("Receta no encontrada")}).finally(()=>{this.loading=!1})})},addProducto(i){const t=this.productosVentas.find(d=>d.producto_id===i.id);if(t){t.cantidad+=1;return}this.productosVentas.push({producto_id:i.id,cantidad:1,precio:i.precio,producto:i})},productosGet(){this.loading=!0,this.$axios.get("productos",{params:{search:this.productosSearch}}).then(i=>{this.productos=i.data.data,this.loading=!1}).catch(i=>{this.loading=!1,console.error(i)})},submitVenta(){this.loading=!0,this.$axios.post("ventas",{ci:this.venta.nit,nombre:this.venta.nombre,productos:this.productosVentas,tipo_venta:this.venta.tipo_venta,tipo_pago:this.venta.tipo_pago}).then(i=>{this.ventaDialog=!1,this.loading=!1,this.$alert.success("Venta realizada con \xE9xito"),this.productosVentas=[],N.nota(i.data)}).catch(i=>{this.loading=!1,console.error(i)})},addVenta(){this.venta={indicaciones:"",observaciones:""},this.ventaDialog=!0,this.productosVentas=[]},sendWhatsapp(i){const t=`${this.$url}/../venta/${i.id}/pdf`,d=`https://api.whatsapp.com/send?phone=${this.paciente.telefono}&text=Hola ${this.paciente.nombre}, aqu\xED tienes tu venta: ${t}`;window.open(d,"_blank").focus()},printVenta(i){const t=`${this.$url}/../venta/${i.id}/pdf`;window.open(t,"_blank")},startRecognition(i){this.recognition?(this.activeField=i,this.recognition.start()):this.$q.notify({color:"negative",message:"El reconocimiento de voz no est\xE1 soportado en este navegador"})}},computed:{cambio(){let i=this.efectivo-this.productosVentas.reduce((t,d)=>t+d.cantidad*d.precio,0);return i<0&&(i=0),i}}},P={class:"row"},T={class:"col-12 col-md-7 q-pa-xs"},z=["onClick"],F={style:{padding:"0",margin:"0"},class:"cursor-pointer"},G={style:{"max-width":"190px",overflow:"hidden","text-overflow":"ellipsis","line-height":"0.9"}},$={style:{padding:"0",margin:"0"},class:"cursor-pointer"},H={style:{"max-width":"190px",overflow:"hidden","text-overflow":"ellipsis","line-height":"0.9"}},M={class:"cursor-pointer"},O={style:{"max-width":"190px",overflow:"hidden","text-overflow":"ellipsis","line-height":"0.9"},class:"text-right"},W={class:"col-12 col-md-5 q-pa-xs"},J={class:"text-right flex items-center"},L={style:{padding:"0",margin:"0"}},Y={style:{"max-width":"190px",overflow:"hidden","text-overflow":"ellipsis","line-height":"0.9"}},Z={style:{padding:"0",margin:"0"}},j=["onUpdate:modelValue"],A={style:{padding:"0",margin:"0"}},K=["onUpdate:modelValue"],X={class:"text-right"},ee={class:"text-right text-bold"},te={class:"row"},oe={class:"col-12 col-md-3 q-pa-xs"},ie={class:"col-12 col-md-3 q-pa-xs"},se={class:"col-12 col-md-3 q-pa-xs"},ne={class:"col-12 col-md-3 q-pa-xs"},le={class:"col-12 q-pa-xs"},ae={style:{padding:"0",margin:"0"}},de={style:{"max-width":"190px",overflow:"hidden","text-overflow":"ellipsis","line-height":"0.9"}},re={style:{padding:"0",margin:"0"}},ce={style:{padding:"0",margin:"0"}},ue={class:"text-right"},pe={class:"text-right text-bold"},he={style:{padding:"0",margin:"0"}},me={class:"text-right"},ge={style:{padding:"0",margin:"0"},class:"text-right"},ve={class:"col-12 q-pa-xs"};function fe(i,t,d,c,n,u){return p(),R(E,{class:"q-pa-xs"},{default:a(()=>[s(k,{flat:"",bordered:""},{default:a(()=>[s(v,{class:"row items-center q-pb-none"},{default:a(()=>[t[10]||(t[10]=e("div",{class:"text-h6"},"Ventas",-1)),s(h,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:t[0]||(t[0]=o=>i.$router.go(-1))})]),_:1}),s(v,null,{default:a(()=>[s(U,{onSubmit:u.clickDialogVenta},{default:a(()=>[e("div",P,[e("div",T,[s(_,{modelValue:n.productosSearch,"onUpdate:modelValue":[t[1]||(t[1]=o=>n.productosSearch=o),u.productosGet],outlined:"",clearable:"",label:"Buscar producto",dense:"",debounce:"300"},{append:a(()=>[s(h,{flat:"",round:"",dense:"",icon:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"]),s(y,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:a(()=>[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Nombres"),e("th",null,"Unidad"),e("th",null,"Precio")])],-1)),e("tbody",null,[(p(!0),m(x,null,b(n.productos,(o,r)=>(p(),m("tr",{key:r,onClick:f=>u.addProducto(o)},[e("td",null,l(o.id),1),e("td",F,[e("div",G,l(i.$filters.textUpper(o.nombre)),1)]),e("td",$,[e("div",H,l(i.$filters.textUpper(o.unidad)),1)]),e("td",M,[e("div",O,l(o.precio)+" Bs ",1)])],8,z))),128))])]),_:1})]),e("div",W,[e("div",J,[s(h,{icon:"add_circle_outline",size:"10px",onClick:u.recoveryReceta,color:"green",dense:"","no-caps":"",label:"Recuperar venta"},null,8,["onClick"]),s(S),s(h,{icon:"delete",size:"10px",color:"red",dense:"",flat:"","no-caps":"",label:"limpiar",onClick:t[2]||(t[2]=o=>n.productosVentas=[])})]),s(y,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:a(()=>[t[13]||(t[13]=e("thead",null,[e("tr",null,[e("th",null,"Producto"),e("th",null,"Cantidad"),e("th",null,"Precio"),e("th",null,"Subtotal")])],-1)),e("tbody",null,[(p(!0),m(x,null,b(n.productosVentas,(o,r)=>{var f;return p(),m("tr",{key:r},[e("td",L,[e("div",Y,[s(q,{name:"delete",color:"red",class:"cursor-pointer",onClick:g=>n.productosVentas.splice(r,1)},null,8,["onClick"]),B(" "+l(o.producto_id)+" "+l(i.$filters.textUpper((f=o.producto)==null?void 0:f.nombre)),1)])]),e("td",Z,[V(e("input",{"onUpdate:modelValue":g=>o.cantidad=g,type:"number",style:{width:"50px"}},null,8,j),[[w,o.cantidad]])]),e("td",A,[V(e("input",{"onUpdate:modelValue":g=>o.precio=g,type:"number",style:{width:"50px"},step:"0.01"},null,8,K),[[w,o.precio]])]),e("td",X,l(o.cantidad*o.precio)+" Bs ",1)])}),128))]),e("tfoot",null,[e("tr",null,[t[12]||(t[12]=e("td",{colspan:"3",class:"text-right"},"Total",-1)),e("td",ee,l(n.productosVentas.reduce((o,r)=>o+r.cantidad*r.precio,0))+" Bs",1)])])]),_:1}),s(h,{label:"Realizar venta",color:"positive",class:"full-width","no-caps":"",loading:n.loading,type:"submit",icon:"add_circle_outline"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1}),s(D,{modelValue:n.ventaDialog,"onUpdate:modelValue":t[9]||(t[9]=o=>n.ventaDialog=o)},{default:a(()=>[s(k,{style:{width:"650px",margin:"0 auto"}},{default:a(()=>[s(v,{class:"q-pb-none row items-center"},{default:a(()=>[t[14]||(t[14]=e("div",{class:"text-h6"},"Nueva venta",-1)),s(S),s(h,{flat:"",round:"",dense:"",icon:"close",onClick:t[3]||(t[3]=o=>n.ventaDialog=!1)})]),_:1}),s(v,null,{default:a(()=>[s(U,{onSubmit:u.submitVenta},{default:a(()=>[e("div",te,[e("div",oe,[s(_,{modelValue:n.venta.nit,"onUpdate:modelValue":[t[4]||(t[4]=o=>n.venta.nit=o),u.searchCliente],outlined:"",dense:"",label:"CI/NIT"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",ie,[s(_,{modelValue:n.venta.nombre,"onUpdate:modelValue":t[5]||(t[5]=o=>n.venta.nombre=o),outlined:"",dense:"",label:"Nombre"},null,8,["modelValue"])]),e("div",se,[s(C,{modelValue:n.venta.tipo_venta,"onUpdate:modelValue":t[6]||(t[6]=o=>n.venta.tipo_venta=o),outlined:"",dense:"",label:"Tipo de venta",options:["Interno","Externo"]},null,8,["modelValue"])]),e("div",ne,[s(C,{modelValue:n.venta.tipo_pago,"onUpdate:modelValue":t[7]||(t[7]=o=>n.venta.tipo_pago=o),outlined:"",dense:"",label:"Tipo de pago",options:["Efectivo","QR"]},null,8,["modelValue"])]),e("div",le,[s(y,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:a(()=>[t[18]||(t[18]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Producto"),e("th",null,"Cantidad"),e("th",null,"Precio"),e("th",null,"Subtotal")])],-1)),e("tbody",null,[(p(!0),m(x,null,b(n.productosVentas,(o,r)=>(p(),m("tr",null,[e("td",null,l(o.producto_id),1),e("td",ae,[e("div",de,l(i.$filters.textUpper(o.producto.nombre)),1)]),e("td",re,l(o.cantidad),1),e("td",ce,l(o.precio)+" Bs ",1),e("td",ue,l(o.cantidad*o.precio)+" Bs ",1)]))),256))]),e("tfoot",null,[e("tr",null,[t[15]||(t[15]=e("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),e("td",pe,l(n.productosVentas.reduce((o,r)=>o+r.cantidad*r.precio,0))+" Bs",1)]),e("tr",null,[t[16]||(t[16]=e("td",{style:{padding:"0",margin:"0"},colspan:"3",class:"text-right text-bold"},"Efectivo",-1)),e("td",he,[e("div",me,[V(e("input",{"onUpdate:modelValue":t[8]||(t[8]=o=>n.efectivo=o),outlined:"",dense:"",label:"Efectivo",style:{width:"100px"}},null,512),[[w,n.efectivo]])])])]),e("tr",null,[t[17]||(t[17]=e("td",{style:{padding:"0",margin:"0"},colspan:"3",class:"text-right text-bold"},"Cambio",-1)),e("td",ge,l(u.cambio),1)])])]),_:1})]),e("div",ve,[s(h,{label:"Realizar venta",color:"positive",class:"full-width","no-caps":"",loading:n.loading,type:"submit"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t[19]||(t[19]=e("div",{id:"myElement",class:"hidden"},null,-1))]),_:1})}var Ue=Q(I,[["render",fe]]);export{Ue as default};
