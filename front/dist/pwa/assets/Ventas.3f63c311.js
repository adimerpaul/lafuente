import{_ as D,O as u,X as h,R as e,Q as t,T as a,Z as w,aG as _,aH as x,$ as m,V as i,U as n,aF as C,S as E,J as v,P as b,Y as T,as as g}from"./index.91340ddf.js";import{a as p,b as r,d as f}from"./QMenu.3bda8529.js";import{Q as F}from"./QSelect.4c70e5f1.js";import{Q}from"./QBtnDropdown.14760f3e.js";import{Q as I}from"./QChip.ddf67662.js";import{Q as B}from"./QMarkupTable.f2526c95.js";import{Q as z}from"./QPage.4f16a01c.js";import{C as k}from"./ClosePopup.95e1ab29.js";import{h as y}from"./moment.40bc58bf.js";import{I as A}from"./Imprimir.5c23d6e9.js";import{E as S}from"./Excel.a5e16faf.js";import"./format.2cae61da.js";import"./QBtnGroup.4a21977c.js";import"./_commonjsHelpers.a26ce4be.js";const Y={name:"Ventas",data(){return{ventas:[],venta:{},ventaDialog:!1,fechaInicio:y().format("YYYY-MM-DD"),fechaFin:y().format("YYYY-MM-DD"),loading:!1,actionPeriodo:"",gestiones:[],users:[],user:"",filter:"",roles:["Doctor","Enfermera","Administrativo","Secretaria"],columns:[{name:"actions",label:"Acciones",align:"center"},{name:"nombre",label:"Nombre",align:"left",field:"nombre"},{name:"descripcion",label:"Descripci\xF3n",align:"left",field:"descripcion"},{name:"unidad",label:"Unidad",align:"left",field:"unidad"},{name:"precio",label:"Precio",align:"left",field:"precio"},{name:"stock",label:"Stock",align:"left",field:"stock"},{name:"stock_minimo",label:"Stock m\xEDnimo",align:"left",field:"stock_minimo"},{name:"stock_maximo",label:"Stock m\xE1ximo",align:"left",field:"stock_maximo"}]}},mounted(){this.ventasGet(),this.usersGet()},methods:{exportExcel(){let o=[{columns:[{label:"ID",value:"id"},{label:"Fecha",value:"fecha"},{label:"Cliente",value:"cliente.nombre"},{label:"Usuario",value:"user.name"},{label:"Estado",value:"estado"},{label:"Total",value:"total"},{label:"Detalle",value:"detailsText"},{label:"Tipo venta",value:"tipo_venta"}],content:this.ventas}];S.export(o,"Ventas")},usersGet(){this.$axios.get("users").then(o=>{this.users=o.data}).catch(o=>{this.$alert.error(o.response.data.message)})},imprimir(o){A.nota(o)},tipoVentasChange(o){this.$axios.put(`tipoVentasChange/${o}`).then(l=>{this.$alert.success("Tipo de venta cambiado"),this.ventasGet()}).catch(l=>{this.$alert.error(l.response.data.message)})},anular(o){this.$alert.dialog("\xBFEst\xE1 seguro de anular la venta?").onOk(()=>{this.$axios.put(`ventasAnular/${o}`).then(l=>{this.$alert.success("Venta anulada"),this.ventasGet()}).catch(l=>{this.$alert.error(l.response.data.message)})})},ventasGet(){this.loading=!0,this.$axios.get("ventas",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,user:this.user}}).then(o=>{this.ventas=o.data}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1})}},computed:{usersTodos(){return[{label:"Todos",value:""},...this.users.map(o=>({label:o.name,value:o.id}))]},totalInternos(){return this.ventas.reduce((o,l)=>l.tipo_venta==="Interno"&&l.estado==="Activo"?o+parseFloat(l.total):o,0)},totalExternos(){return this.ventas.reduce((o,l)=>l.tipo_venta==="Externo"&&l.estado==="Activo"?o+parseFloat(l.total):o,0)}}},q={class:"row"},G={class:"col-12 col-md-4 q-pa-xs"},U={class:"col-12 col-md-4 q-pa-xs"},N={class:"col-12 col-md-4 q-pa-xs"},M={class:"col-12"},P={class:"row"},O={class:"col-12 col-md-2"},L={class:"col-12 col-md-2"},R={class:"col-12 col-md-2"},$={class:"col-12 col-md-2"},H={class:"col-12 col-md-2 text-right"},J={class:"col-12 col-md-2 text-right"},X={class:"text-bold"},Z={style:{"max-width":"200px","wrap-option":"wrap","line-height":"0.9"}};function j(o,l,K,W,d,c){return u(),h(w,null,[e(z,{class:"q-pa-xs"},{default:t(()=>[a("div",q,[a("div",G,[e(_,{flat:"",bordered:""},{default:t(()=>[e(x,{class:"q-pa-none"},{default:t(()=>[e(p,{class:"bg-indigo"},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(m,{name:"monetization_on",size:"50px",color:"white"})]),_:1}),e(r,null,{default:t(()=>[e(f,{caption:"",class:"text-white"},{default:t(()=>l[4]||(l[4]=[i("Ventas Interno")])),_:1}),e(f,{class:"text-white text-h4"},{default:t(()=>[i(n(c.totalInternos)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),a("div",U,[e(_,{flat:"",bordered:""},{default:t(()=>[e(x,{class:"q-pa-none"},{default:t(()=>[e(p,{class:"bg-orange"},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(m,{name:"monetization_on",size:"50px",color:"white"})]),_:1}),e(r,null,{default:t(()=>[e(f,{caption:"",class:"text-white"},{default:t(()=>l[5]||(l[5]=[i("Ventas Externo")])),_:1}),e(f,{class:"text-white text-h4"},{default:t(()=>[i(n(c.totalExternos)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),a("div",N,[e(_,{flat:"",bordered:""},{default:t(()=>[e(x,{class:"q-pa-none"},{default:t(()=>[e(p,{class:"bg-green"},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(m,{name:"monetization_on",size:"50px",color:"white"})]),_:1}),e(r,null,{default:t(()=>[e(f,{caption:"",class:"text-white"},{default:t(()=>l[6]||(l[6]=[i("Ventas Total")])),_:1}),e(f,{class:"text-white text-h4"},{default:t(()=>[i(n(c.totalInternos+c.totalExternos)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),a("div",M,[e(_,{flat:"",bordered:""},{default:t(()=>[e(x,{class:"q-pa-none"},{default:t(()=>[a("div",P,[a("div",O,[e(C,{modelValue:d.fechaInicio,"onUpdate:modelValue":l[0]||(l[0]=s=>d.fechaInicio=s),label:"Fecha inicio",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),a("div",L,[e(C,{modelValue:d.fechaFin,"onUpdate:modelValue":l[1]||(l[1]=s=>d.fechaFin=s),label:"Fecha fin",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),a("div",R,[e(F,{modelValue:d.user,"onUpdate:modelValue":l[2]||(l[2]=s=>d.user=s),options:c.usersTodos,label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),a("div",$,[e(E,{color:"primary",label:"Buscar","no-caps":"",icon:"search",loading:d.loading,onClick:l[3]||(l[3]=s=>c.ventasGet())},null,8,["loading"])]),a("div",H,[e(Q,{color:"primary",label:"Exportar","no-caps":""},{default:t(()=>[v((u(),b(p,{clickable:"",onClick:c.exportExcel},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(m,{name:"file_download"})]),_:1}),e(r,null,{default:t(()=>l[7]||(l[7]=[i("Excel")])),_:1})]),_:1},8,["onClick"])),[[g],[k]])]),_:1})]),a("div",J,[e(E,{color:"positive",label:"Nueva venta","no-caps":"",icon:"add_circle_outline",loading:d.loading,to:"/ventaNuevo"},null,8,["loading"])])])]),_:1})]),_:1})])]),e(B,{dense:"","wrap-cells":""},{default:t(()=>[l[10]||(l[10]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",null,"Acciones"),a("th",null,"ID"),a("th",null,"Fecha"),a("th",null,"Cliente"),a("th",null,"Usuario"),a("th",null,"Estado"),a("th",null,"Total"),a("th",null,"Detalle"),a("th",null,"Tipo venta")])],-1)),a("tbody",null,[d.ventas.length!=0?(u(!0),h(w,{key:0},T(d.ventas,(s,ee)=>(u(),h("tr",{key:s.id},[a("td",null,[e(Q,{color:"primary",label:"Opciones","no-caps":"",dense:"",size:"10px"},{default:t(()=>[v((u(),b(p,{clickable:"",onClick:V=>c.imprimir(s)},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(m,{name:"print"})]),_:1}),e(r,null,{default:t(()=>l[8]||(l[8]=[i("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[g],[k]]),v((u(),b(p,{clickable:"",onClick:V=>c.anular(s.id)},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(m,{name:"delete"})]),_:1}),e(r,null,{default:t(()=>l[9]||(l[9]=[i("Anular")])),_:1})]),_:2},1032,["onClick"])),[[g],[k]]),v((u(),b(p,{clickable:"",onClick:V=>c.tipoVentasChange(s.id)},{default:t(()=>[e(r,{avatar:""},{default:t(()=>[e(m,{name:"swap_horiz"})]),_:1}),e(r,null,{default:t(()=>[i("Cambiar a "+n(s.tipo_venta==="Interno"?"Externo":"Interno"),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[g],[k]])]),_:2},1024)]),a("td",null,n(s.id),1),a("td",null,n(s.fecha)+" "+n(s.hora),1),a("td",null,n(s.cliente.nombre),1),a("td",null,n(s.user.name),1),a("td",null,[e(I,{color:s.estado==="Activo"?"positive":"negative",class:"text-white",dense:""},{default:t(()=>[i(n(s.estado),1)]),_:2},1032,["color"])]),a("td",X,[i(n(s.total)+" ",1),e(I,{size:"10px",color:s.tipo_pago==="Efectivo"?"green":"blue",class:"text-white",dense:""},{default:t(()=>[i(n(s.tipo_pago.charAt(0)),1)]),_:2},1032,["color"])]),a("td",null,[a("div",Z,n(s.detailsText),1)]),a("td",null,[e(I,{color:s.tipo_venta==="Interno"?"indigo":"orange",class:"text-white",dense:""},{default:t(()=>[i(n(s.tipo_venta),1)]),_:2},1032,["color"])])]))),128)):(u(),h(w,{key:1},[],64))])]),_:1})]),_:1}),l[11]||(l[11]=a("div",{id:"myElement",class:"hidden"},null,-1))],64)}var he=D(Y,[["render",j]]);export{he as default};
