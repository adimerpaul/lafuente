import{_ as D,O as p,P as F,Q as i,R as n,aH as f,T as e,S as c,aF as V,X as m,Y as b,Z as y,U as d,aG as w,aI as S,$ as T,V as P,J as u,bd as h}from"./index.83f302da.js";import{Q as B}from"./QPagination.b6e3ddad.js";import{Q as C}from"./QImg.9da1a6a4.js";import{Q as E}from"./QBadge.e74ea7d8.js";import{Q}from"./QMarkupTable.069792a7.js";import{Q as k}from"./QForm.5b6f3bae.js";import{Q as G}from"./QSpace.bfad5768.js";import{Q as q}from"./QSelect.50c97728.js";import{Q as N}from"./QPage.1ab170fa.js";import{I}from"./Imprimir.a9d6b44c.js";import"./format.2cae61da.js";import"./QChip.2559af90.js";import"./QMenu.1f7bb65a.js";import"./moment.40bc58bf.js";const K={name:"ComprasCreate",data(){return{loading:!1,compraDialog:!1,productos:[],productosSearch:"",productosCompras:[],proveedores:[],proveedor:null,compra:{nit:"",nombre:"",tipo_pago:"Efectivo"},pagination:{page:1,rowsPerPage:24,rowsNumber:0}}},computed:{totalCompra(){let s=0;return this.productosCompras.forEach(o=>{s+=o.cantidad*o.precio}),parseFloat(s).toFixed(2)}},methods:{diasRestantesColor(s){if(!s)return{color:"grey",texto:"Sin fecha"};const o=new Date,U=new Date(s).getTime()-o.getTime(),a=Math.ceil(U/(1e3*60*60*24));return a<=14?{color:"red",texto:`${a} d\xEDas`}:a<=28?{color:"orange",texto:`${a} d\xEDas`}:{color:"green",texto:`${a} d\xEDas`}},updatePrecioUnitario(s){const o=parseFloat(s.total/s.cantidad);s.precio=o,s.precio_venta=this.redondear50Centavos(o*1.3)},updatePrecioVenta(s){s.total=parseFloat(s.cantidad*s.precio).toFixed(2),s.precio_venta=this.redondear50Centavos(s.precio*1.3)},redondear50Centavos(s){return Math.ceil(s*2)/2},productosGet(){this.loading=!0,this.$axios.get("productos",{params:{search:this.productosSearch,page:this.pagination.page,per_page:this.pagination.rowsPerPage}}).then(s=>{this.productos=s.data.data,this.pagination.rowsNumber=s.data.total}).catch(s=>{console.error("Error cargando productos:",s)}).finally(()=>{this.loading=!1})},addProducto(s){const o=this.productosCompras.find(v=>v.producto_id===s.id);o?o.cantidad+=1:this.productosCompras.push({producto_id:s.id,cantidad:1,precio:"",lote:"",fecha_vencimiento:"",producto:s})},clickDialogCompra(){if(this.productosCompras.length===0){this.$alert.error("Debe agregar al menos un producto");return}if(this.productosCompras.filter(o=>!o.precio).length>0){this.$alert.error("Todos los productos deben tener precio unitario");return}this.compraDialog=!0},buscarProveedor(){!this.compra.nit||(this.loading=!0,this.$axios.post("searchProveedor",{nit:this.compra.nit}).then(s=>{var o;(o=s.data)!=null&&o.nombre&&(this.compra.nombre=s.data.nombre)}).catch(s=>{console.warn("Proveedor no encontrado",s)}).finally(()=>{this.loading=!1}))},submitCompra(){this.loading=!0;const s={tipo_pago:this.compra.tipo_pago,proveedor_id:this.proveedor.id,nro_factura:this.compra.nro_factura,productos:this.productosCompras};this.$axios.post("compras",s).then(o=>{this.$alert.success("Compra registrada correctamente"),this.compraDialog=!1,this.productosCompras=[],I.reciboCompra(o.data),this.productosGet()}).catch(o=>{console.error("Error registrando compra:",o),this.$alert.error("Error al registrar la compra")}).finally(()=>{})},proveedoresGet(){this.$axios.get("proveedores").then(s=>{this.proveedores=s.data}).catch(s=>{console.error("Error cargando proveedores:",s)}).finally(()=>{})}},mounted(){this.productosGet(),this.proveedoresGet()}},R={class:"row"},M={class:"col-12 col-md-5 q-pa-xs"},L={class:"flex flex-center"},z={class:"row"},$={class:"col-6 col-md-2"},j={class:"absolute-bottom text-center",style:{padding:"0",margin:"0"}},H={style:{"max-width":"190px","line-height":"0.9"}},J={style:{display:"flex","justify-content":"space-between"}},O={class:"text-bold bg-orange text-black border"},X={class:"col-12 col-md-7 q-pa-xs"},Y={class:"pm-none",style:{display:"flex","align-items":"center"}},Z={style:{"max-width":"120px","wrap-option":"warp","line-height":"0.9"}},A={class:"pm-none"},W=["onUpdate:modelValue","onKeyup","onUpdate"],ee={class:"pm-none"},te=["onUpdate:modelValue","onKeyup","onUpdate"],oe={class:"text-right pm-none"},se=["onUpdate:modelValue","onKeyup","onUpdate"],ae={class:"text-right pm-none text-bold"},ne={class:"text-right pm-none"},le={class:"pm-none"},ie=["onUpdate:modelValue"],re={class:"pm-none"},de=["onUpdate:modelValue"],pe={class:"pm-none"},ce=["onUpdate:modelValue"],me={class:"pm-none"},ue={class:"text-right"},he={class:"row"},ge={class:"col-12 col-md-6 q-pa-xs"},xe={class:"col-12 col-md-6 q-pa-xs"},_e={class:"col-12 col-md-6 q-pa-xs"},fe={class:"col-12"},ve={class:"pm-none",style:{display:"flex","align-items":"center"}},be={style:{"max-width":"120px","wrap-option":"warp","line-height":"0.9"}},ye={class:"pm-none"},we={class:"pm-none text-red text-bold text-right"},Ce={class:"pm-none"},Ue={class:"pm-none"};function Ve(s,o,v,U,a,r){return p(),F(N,{class:"q-pa-xs"},{default:i(()=>[n(w,{flat:"",bordered:""},{default:i(()=>[n(f,{class:"row items-center q-pb-none"},{default:i(()=>[o[9]||(o[9]=e("div",{class:"text-h6"},"Compras",-1)),n(c,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:o[0]||(o[0]=t=>s.$router.go(-1))})]),_:1}),n(f,{class:"q-pa-none"},{default:i(()=>[n(k,{onSubmit:r.clickDialogCompra},{default:i(()=>[e("div",R,[e("div",M,[n(V,{modelValue:a.productosSearch,"onUpdate:modelValue":[o[1]||(o[1]=t=>a.productosSearch=t),r.productosGet],outlined:"",clearable:"",label:"Buscar producto",dense:"",debounce:"300"},{append:i(()=>[n(c,{flat:"",round:"",dense:"",icon:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"]),e("div",L,[n(B,{modelValue:a.pagination.page,"onUpdate:modelValue":[o[2]||(o[2]=t=>a.pagination.page=t),r.productosGet],max:Math.ceil(a.pagination.rowsNumber/a.pagination.rowsPerPage),"max-pages":"5",size:"xs","boundary-numbers":"",class:"q-mt-sm"},null,8,["modelValue","max","onUpdate:modelValue"])]),e("div",z,[(p(!0),m(y,null,b(a.productos,t=>(p(),m("div",$,[n(w,{flat:"",bordered:"",class:"cursor-pointer",onClick:g=>r.addProducto(t)},{default:i(()=>[n(C,{src:`${s.$url}../images/${t.imagen}`,class:"q-mb-xs",style:{height:"120px"}},{default:i(()=>[e("div",j,[e("div",H,d(s.$filters.textUpper(t.nombre)),1),e("div",J,[e("span",null,d(t.stock),1),e("span",O,d(t.precio)+" Bs",1)])])]),_:2},1032,["src"])]),_:2},1032,["onClick"])]))),256))])]),e("div",X,[e("div",null,[n(c,{size:"xs",flat:"",round:"",dense:"",icon:"delete",color:"red",onClick:o[3]||(o[3]=t=>a.productosCompras=[]),class:"q-mb-sm"}),o[10]||(o[10]=e("span",{class:"text-subtitle2"},"Productos seleccionados",-1))]),n(Q,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:i(()=>[o[12]||(o[12]=e("thead",null,[e("tr",null,[e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Producto"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Cantidad"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Precio unitario"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Total"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Precio unitario 1.3"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Total"),e("th",{class:"pm-none",style:{"max-width":"60px","line-height":"0.9"}},"Precio venta"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Lote"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"Fecha vencimiento"),e("th",{class:"pm-none",style:{"max-width":"70px","line-height":"0.9"}},"D\xEDas restantes")])],-1)),e("tbody",null,[(p(!0),m(y,null,b(a.productosCompras,(t,g)=>{var x,_;return p(),m("tr",{key:g},[e("td",Y,[n(C,{src:`${s.$url}../images/${(x=t.producto)==null?void 0:x.imagen}`,class:"q-mb-xs",style:{height:"35px",width:"35px"}},null,8,["src"]),e("div",Z,[n(T,{name:"delete",color:"red",class:"cursor-pointer",onClick:l=>a.productosCompras.splice(g,1)},null,8,["onClick"]),P(" "+d(s.$filters.textUpper((_=t.producto)==null?void 0:_.nombre)),1)])]),e("td",A,[u(e("input",{"onUpdate:modelValue":l=>t.cantidad=l,type:"number",style:{width:"50px"},onKeyup:l=>r.updatePrecioVenta(t),onUpdate:l=>r.updatePrecioVenta(t)},null,40,W),[[h,t.cantidad]])]),e("td",ee,[u(e("input",{"onUpdate:modelValue":l=>t.precio=l,type:"number",style:{width:"55px"},step:"0.001",onKeyup:l=>r.updatePrecioVenta(t),onUpdate:l=>r.updatePrecioVenta(t)},null,40,te),[[h,t.precio]])]),e("td",oe,[u(e("input",{"onUpdate:modelValue":l=>t.total=l,type:"number",style:{width:"55px"},step:"0.001",onKeyup:l=>r.updatePrecioUnitario(t),onUpdate:l=>r.updatePrecioUnitario(t)},null,40,se),[[h,t.total]])]),e("td",ae,d(parseFloat(t.precio*1.3).toFixed(2)),1),e("td",ne,d(parseFloat(t.cantidad*t.precio*1.3).toFixed(2)),1),e("td",le,[u(e("input",{"onUpdate:modelValue":l=>t.precio_venta=l,type:"number",style:{width:"55px",color:"red","font-weight":"bold"},step:"0.01"},null,8,ie),[[h,t.precio_venta]])]),e("td",re,[u(e("input",{"onUpdate:modelValue":l=>t.lote=l,type:"text",style:{width:"70px"}},null,8,de),[[h,t.lote]])]),e("td",pe,[u(e("input",{"onUpdate:modelValue":l=>t.fecha_vencimiento=l,type:"date",style:{width:"100px"}},null,8,ce),[[h,t.fecha_vencimiento]])]),e("td",me,[n(E,{color:r.diasRestantesColor(t.fecha_vencimiento).color},{default:i(()=>[P(d(r.diasRestantesColor(t.fecha_vencimiento).texto),1)]),_:2},1032,["color"])])])}),128))]),e("tfoot",null,[e("tr",null,[o[11]||(o[11]=e("td",{colspan:"3",class:"text-right"},"Total",-1)),e("td",ue,d(r.totalCompra)+" Bs",1)])])]),_:1}),n(c,{label:"Registrar compra",color:"primary",class:"full-width","no-caps":"",loading:a.loading,type:"submit",icon:"add_circle_outline"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1}),n(S,{modelValue:a.compraDialog,"onUpdate:modelValue":o[8]||(o[8]=t=>a.compraDialog=t)},{default:i(()=>[n(w,{style:{width:"600px"}},{default:i(()=>[n(f,{class:"row items-center q-pb-none"},{default:i(()=>[o[13]||(o[13]=e("div",{class:"text-h6"},"Confirmar compra",-1)),n(G),n(c,{flat:"",round:"",dense:"",icon:"close",onClick:o[4]||(o[4]=t=>a.compraDialog=!1)})]),_:1}),n(f,null,{default:i(()=>[n(k,{onSubmit:r.submitCompra},{default:i(()=>[e("div",he,[e("div",ge,[n(q,{modelValue:a.proveedor,"onUpdate:modelValue":[o[5]||(o[5]=t=>a.proveedor=t),r.buscarProveedor],options:a.proveedores,"option-label":"nombre","option-value":"id",label:"Proveedor",dense:"",outlined:"",rules:[t=>!!t||"Campo requerido",t=>(t&&(this.compra.nit=t.nit,this.compra.nombre=t.nombre),!0)]},null,8,["modelValue","options","onUpdate:modelValue","rules"])]),e("div",xe,[n(q,{modelValue:a.compra.tipo_pago,"onUpdate:modelValue":o[6]||(o[6]=t=>a.compra.tipo_pago=t),options:["Efectivo","QR"],label:"Tipo de pago",dense:"",outlined:""},null,8,["modelValue"])]),e("div",_e,[n(V,{modelValue:a.compra.nro_factura,"onUpdate:modelValue":o[7]||(o[7]=t=>a.compra.nro_factura=t),outlined:"",dense:"",label:"Nro. factura"},null,8,["modelValue"])]),e("div",fe,[n(Q,{flat:"",dense:"","wrap-cells":"",bordered:""},{default:i(()=>[o[14]||(o[14]=e("thead",null,[e("tr",null,[e("th",{class:"pm-none",style:{"max-width":"60px","wrap-option":"wrap","line-height":"0.9"}},"Producto"),e("th",{class:"pm-none",style:{"max-width":"60px","wrap-option":"wrap","line-height":"0.9"}},"Cantidad"),e("th",{class:"pm-none",style:{"max-width":"60px","line-height":"0.9"}},"Precio venta"),e("th",{class:"pm-none",style:{"max-width":"60px","wrap-option":"wrap","line-height":"0.9"}},"Lote"),e("th",{class:"pm-none",style:{"max-width":"60px","wrap-option":"wrap","line-height":"0.9"}},"Fecha vencimiento")])],-1)),e("tbody",null,[(p(!0),m(y,null,b(a.productosCompras,(t,g)=>{var x,_;return p(),m("tr",{key:g},[e("td",ve,[n(C,{src:`${s.$url}../images/${(x=t.producto)==null?void 0:x.imagen}`,class:"q-mb-xs",style:{height:"35px",width:"35px"}},null,8,["src"]),e("div",be,d(s.$filters.textUpper((_=t.producto)==null?void 0:_.nombre)),1)]),e("td",ye,d(t.cantidad),1),e("td",we,d(t.precio_venta)+" Bs ",1),e("td",Ce,d(t.lote),1),e("td",Ue,d(t.fecha_vencimiento),1)])}),128))])]),_:1})])]),n(c,{label:"Guardar compra",color:"primary",class:"full-width q-mt-md",type:"submit","no-caps":"",icon:"save",loading:a.loading},null,8,["loading"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o[15]||(o[15]=e("div",{id:"myElement",class:"hidden"},null,-1))]),_:1})}var Re=D(K,[["render",Ve]]);export{Re as default};
