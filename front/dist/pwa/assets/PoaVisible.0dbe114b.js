import{Q as w,a as _}from"./QMarkupTable.57b7b7ae.js";import{_ as C,O as n,P as v,Q as d,R as i,az as k,T as e,W as s,V as y,ax as b,U as V,Y as u,Z as f,$ as x,S as p,ay as $}from"./index.248e54b0.js";import{Q}from"./QPage.3e0e6402.js";const P={name:"PoaVisible",data(){return{poa_id:this.$route.params.id,poa:{},materials:[],buscar:"",loading:!1}},mounted(){this.poaGet(),this.materialsGet()},methods:{imprimir(){const t=`poaPrint/${this.poa_id}`;window.open(this.$url+t,"_blank")},materialDelete(t){this.$axios.delete(`materialDelete/${t.id}`).then(a=>{this.$alert.success("Material eliminado"),this.poa.detalles=this.poa.detalles.filter(h=>h.id!==t.id)}).catch(a=>{this.$alert.error(a.response.data.message)})},updateCantidad(t){this.$axios.put(`materialUpdate/${t.id}`,{cantidad:t.cantidad}).then(a=>{this.$alert.success("Cantidad actualizada")}).catch(a=>{this.$alert.error(a.response.data.message)})},materialAdd(t){if(this.poa.detalles.find(a=>a.material_id===t.id))return this.$alert.error("Material ya agregado"),!1;this.loading=!0,this.$axios.post("materialAdd",{material_id:t.id,poa_id:this.poa_id,cantidad:1}).then(a=>{this.$alert.success("Material agregado"),this.poa.detalles.push(a.data)}).catch(a=>{this.$alert.error(a.response.data.message)}).finally(()=>{this.loading=!1})},materialsGet(){this.$axios.get("materials").then(t=>{this.materials=t.data}).catch(t=>{this.$alert.error(t.response.data.message)})},poaGet(){this.$axios.get(`poas/${this.poa_id}`).then(t=>{this.poa=t.data}).catch(t=>{this.$alert.error(t.response.data.message)})}},computed:{materialsFiltered(){return this.materials.filter(t=>t.descripcion.toLowerCase().includes(this.buscar.toLowerCase())||t.partida.toString().toLowerCase().includes(this.buscar.toLowerCase()))}}},U={class:"row"},B={class:"col-12 col-md-3"},M={class:"col-6 col-md-3"},A={class:"col-6 col-md-3"},F={class:"col-12 col-md-3"},L={class:"col-12 col-md-6"},S={style:{width:"150px","line-height":"1","word-wrap":"break-word","white-space":"normal"}},z={class:"col-12 col-md-6"},D={class:"text-right"},G={style:{width:"150px","line-height":"1","word-wrap":"break-word","white-space":"normal"}};function I(t,a,h,N,o,r){return n(),v(Q,{class:"q-pa-md"},{default:d(()=>[i($,{flat:"",bordered:""},{default:d(()=>[i(k,null,{default:d(()=>{var m,g;return[e("div",U,[e("div",B,[a[1]||(a[1]=e("span",{class:"text-bold"},"Area: ",-1)),e("span",null,s((m=o.poa.area)==null?void 0:m.nombre),1)]),e("div",M,[a[2]||(a[2]=e("span",{class:"text-bold"},"Periodo: ",-1)),e("span",null,s((g=o.poa.periodo)==null?void 0:g.periodo),1)]),e("div",A,[a[3]||(a[3]=e("span",{class:"text-bold"},"Estado: ",-1)),i(w,{color:o.poa.estado==="Abierto"?"positive":"negative",dense:"","text-color":"white"},{default:d(()=>[y(s(o.poa.estado),1)]),_:1},8,["color"])]),e("div",F,[a[4]||(a[4]=e("span",{class:"text-bold"},"Fecha: ",-1)),e("span",null,s(o.poa.fecha),1)]),e("div",L,[i(b,{modelValue:o.buscar,"onUpdate:modelValue":a[0]||(a[0]=l=>o.buscar=l),label:"Buscar",dense:"",outlined:""},{append:d(()=>[i(V,{name:"search"})]),_:1},8,["modelValue"]),i(_,{dense:"",flat:"",bordered:"","wrap-cells":""},{default:d(()=>[a[5]||(a[5]=e("thead",{class:"bg-primary text-white"},[e("tr",null,[e("th",null,"Material"),e("th",null,"Partida"),e("th",null,"Unidad"),e("th",null,"Cantidad"),e("th",null,"Precio"),e("th",null,"Opcion")])],-1)),e("tbody",null,[(n(!0),u(x,null,f(r.materialsFiltered,l=>(n(),u("tr",{key:l.id},[e("td",null,[e("div",S,s(l.descripcion),1)]),e("td",null,s(l.partida),1),e("td",null,s(l.unidad),1),e("td",null,s(l.cantidad),1),e("td",null,s(l.precio),1),e("td",null,[i(p,{onClick:c=>r.materialAdd(l),color:"positive",dense:"",icon:"add",size:"10px",loading:o.loading},null,8,["onClick","loading"])])]))),128))])]),_:1})]),e("div",z,[e("div",D,[i(p,{color:"primary",label:"Imprimir",icon:"print","no-caps":"",onClick:r.imprimir},null,8,["onClick"])]),i(_,{dense:"",flat:"",bordered:"","wrap-cells":""},{default:d(()=>[a[6]||(a[6]=e("thead",{class:"bg-primary text-white"},[e("tr",null,[e("th",null,"Material"),e("th",null,"Partida"),e("th",null,"Unidad"),e("th",null,"Cantidad"),e("th",null,"Precio"),e("th",null,"Subtotal"),e("th",null,"Opcion")])],-1)),e("tbody",null,[(n(!0),u(x,null,f(o.poa.detalles,l=>(n(),u("tr",{key:l.id},[e("td",null,[e("div",G,s(l.material.descripcion),1)]),e("td",null,s(l.material.partida),1),e("td",null,s(l.material.unidad),1),e("td",null,[i(b,{modelValue:l.cantidad,"onUpdate:modelValue":[c=>l.cantidad=c,c=>r.updateCantidad(l)],dense:"",outlined:"",type:"number",min:"1",debounce:500},null,8,["modelValue","onUpdate:modelValue"])]),e("td",null,s(l.material.precio),1),e("td",null,s((l.cantidad*l.material.precio).toFixed(2)),1),e("td",null,[i(p,{color:"negative",dense:"",icon:"delete",size:"10px",onClick:c=>r.materialDelete(l),loading:o.loading},null,8,["onClick","loading"])])]))),128))])]),_:1})])])]}),_:1})]),_:1})]),_:1})}var q=C(P,[["render",I]]);export{q as default};
