import{_ as R,B as u,C as P,E as n,F as s,aG as v,G as e,Q as h,aE as f,L as m,M as b,O as _,H as l,aF as x,x as V,bb as w,aH as D,I as N,J as B}from"./index.edcbe16c.js";import{Q as E}from"./QPagination.b2f07a77.js";import{Q}from"./QImg.89c0d88b.js";import{Q as S}from"./QSpace.544f0b5a.js";import{Q as C}from"./QMarkupTable.d530df3c.js";import{Q as U}from"./QForm.c2332dc1.js";import{Q as q}from"./QSelect.04c3cd71.js";import{Q as I}from"./QPage.dc5941e2.js";import{I as z}from"./Imprimir.6ee33c34.js";import"./format.2cae61da.js";import"./QChip.111857c6.js";import"./QMenu.beaca1ef.js";import"./selection.850d2530.js";import"./moment.40bc58bf.js";const F={name:"VentasNew",props:{},emits:["pacienteGet"],data(){return{loading:!1,paciente:{},ventaDialog:!1,efectivo:"",venta:{nit:"0",nombre:"SN"},pagination:{page:1,rowsPerPage:24,rowsNumber:0},receta_id:null,recognition:null,activeField:null,productos:[],productosSearch:"",productosVentas:[],unidades:["","capsulas","comprimidos","pastillas","ml","mg","otro"],vias:["","oral","intramuscular","intravenosa","subcut\xE1nea","t\xF3pica","oft\xE1lmica","\xF3tica","nasal","rectal","vaginal"],frecuencias:["","cada 8 horas","cada 12 horas","cada 24 horas","cada 48 horas","cada 72 horas","cada 96 horas","cada 120 horas","cada 144 horas","cada 168 horas"],duraciones:["","3 dias","5 dias","7 dias","10 dias","14 dias","21 dias","28 dias","30 dias","60 dias","90 dias","120 dias","180 dias","240 dias","365 dias"]}},mounted(){if(this.productosGet(),"webkitSpeechRecognition"in window||"SpeechRecognition"in window){const i=window.SpeechRecognition||window.webkitSpeechRecognition;this.recognition=new i,this.recognition.lang="es-ES",this.recognition.interimResults=!1,this.recognition.continuous=!1,this.recognition.onresult=t=>{const d=t.results[0][0].transcript;this.activeField&&(this.venta[this.activeField]+=d)},this.recognition.onerror=t=>{console.error("Error en reconocimiento de voz:",t.error)}}else console.error("El reconocimiento de voz no est\xE1 soportado en este navegador")},methods:{searchCliente(){this.loading=!0,this.$axios.post("searchCliente",{nit:this.venta.nit}).then(i=>{this.loading=!1,i.data.nombre&&(this.venta.nombre=i.data.nombre)}).catch(i=>{this.loading=!1,console.error(i)})},clickDialogVenta(){if(this.productosVentas.length===0){this.$alert.error("Debe agregar al menos un producto a la venta");return}this.ventaDialog=!0,this.venta={nit:"0",nombre:"SN",tipo_venta:"Interno",tipo_pago:"Efectivo"},this.efectivo=""},recoveryReceta(){this.$alert.dialogPrompt("Numero de receta ",{title:"Recuperar receta",cancel:!0,persistent:!0}).onOk(i=>{this.receta_id=i,this.loading=!0,this.$axios.get("receta/"+i).then(t=>{const d=t.data.receta_detalles;if(d.length===0){this.$alert.error("Receta vac\xEDa");return}this.productosVentas=d.filter(p=>p.producto_id).map(p=>({producto_id:p.producto_id,cantidad:p.cantidad,precio:p.producto.precio,producto:p.producto}))}).catch(t=>{this.$alert.error("Receta no encontrada")}).finally(()=>{this.loading=!1})})},addProducto(i){const t=this.productosVentas.find(d=>d.producto_id===i.id);if(t){t.cantidad+=1;return}this.productosVentas.push({producto_id:i.id,cantidad:1,precio:i.precio,producto:i})},productosGet(){this.loading=!0,this.$axios.get("productos",{params:{search:this.productosSearch,page:this.pagination.page,per_page:this.pagination.rowsPerPage}}).then(i=>{this.productos=i.data.data,this.pagination.rowsNumber=i.data.total,this.pagination.page=i.data.current_page,this.loading=!1}).catch(i=>{this.loading=!1,console.error(i)})},submitVenta(){this.loading=!0,this.$axios.post("ventas",{ci:this.venta.nit,nombre:this.venta.nombre,productos:this.productosVentas,tipo_venta:this.venta.tipo_venta,tipo_pago:this.venta.tipo_pago,receta_id:this.receta_id}).then(i=>{this.ventaDialog=!1,this.loading=!1,this.$alert.success("Venta realizada con \xE9xito"),this.productosVentas=[],z.nota(i.data),this.receta_id=null,this.productosGet()}).catch(i=>{this.loading=!1,console.error(i)})},addVenta(){this.venta={indicaciones:"",observaciones:""},this.ventaDialog=!0,this.productosVentas=[]},sendWhatsapp(i){const t=`${this.$url}/../venta/${i.id}/pdf`,d=`https://api.whatsapp.com/send?phone=${this.paciente.telefono}&text=Hola ${this.paciente.nombre}, aqu\xED tienes tu venta: ${t}`;window.open(d,"_blank").focus()},printVenta(i){const t=`${this.$url}/../venta/${i.id}/pdf`;window.open(t,"_blank")},startRecognition(i){this.recognition?(this.activeField=i,this.recognition.start()):this.$q.notify({color:"negative",message:"El reconocimiento de voz no est\xE1 soportado en este navegador"})}},computed:{cambio(){let i=this.efectivo-this.productosVentas.reduce((t,d)=>t+d.cantidad*d.precio,0);return i<0&&(i=0),i}}},G={class:"row"},T={class:"col-12 col-md-7 q-pa-xs"},M={class:"flex flex-center"},H={class:"row"},L={class:"col-6 col-md-2"},O={class:"absolute-bottom text-center",style:{padding:"0",margin:"0"}},$={style:{"max-width":"190px","line-height":"0.9"}},j={style:{display:"flex","justify-content":"space-between"}},J={class:"text-bold bg-orange text-black border"},W={class:"col-12 col-md-5 q-pa-xs"},A={class:"text-right flex items-center"},K={style:{padding:"0",margin:"0",display:"flex","align-items":"center"}},X={style:{"max-width":"190px",overflow:"hidden","text-overflow":"ellipsis","line-height":"0.9"}},Y={style:{padding:"0",margin:"0"}},Z=["onUpdate:modelValue"],ee={style:{padding:"0",margin:"0"}},te=["onUpdate:modelValue"],oe={class:"text-right"},ie={class:"text-right text-bold"},se={class:"row"},ae={class:"col-12 col-md-3 q-pa-xs"},ne={class:"col-12 col-md-3 q-pa-xs"},le={class:"col-12 col-md-3 q-pa-xs"},de={class:"col-12 col-md-3 q-pa-xs"},re={class:"col-12 q-pa-xs"},ce={style:{padding:"0",margin:"0"}},pe={style:{"max-width":"190px",overflow:"hidden","text-overflow":"ellipsis","line-height":"0.9"}},ue={style:{padding:"0",margin:"0"}},he={style:{padding:"0",margin:"0"}},me={class:"text-right"},ge={class:"text-right text-bold"},ve={style:{padding:"0",margin:"0"}},fe={class:"text-right"},be={style:{padding:"0",margin:"0"},class:"text-right"},_e={class:"col-12 q-pa-xs"};function xe(i,t,d,p,a,c){return u(),P(I,{class:"q-pa-xs"},{default:n(()=>[s(x,{flat:"",bordered:""},{default:n(()=>[s(v,{class:"row items-center q-pb-none"},{default:n(()=>[t[11]||(t[11]=e("div",{class:"text-h6"},"Ventas",-1)),s(h,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:t[0]||(t[0]=o=>i.$router.go(-1))})]),_:1}),s(v,{class:"q-pa-none"},{default:n(()=>[s(U,{onSubmit:c.clickDialogVenta},{default:n(()=>[e("div",G,[e("div",T,[s(f,{modelValue:a.productosSearch,"onUpdate:modelValue":[t[1]||(t[1]=o=>a.productosSearch=o),c.productosGet],outlined:"",clearable:"",label:"Buscar producto",dense:"",debounce:"300"},{append:n(()=>[s(h,{flat:"",round:"",dense:"",icon:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"]),e("div",M,[s(E,{size:"xs",modelValue:a.pagination.page,"onUpdate:modelValue":[t[2]||(t[2]=o=>a.pagination.page=o),c.productosGet],max:Math.ceil(a.pagination.rowsNumber/a.pagination.rowsPerPage),color:"primary","boundary-numbers":"","max-pages":"5"},null,8,["modelValue","max","onUpdate:modelValue"])]),e("div",H,[(u(!0),m(_,null,b(a.productos,o=>(u(),m("div",L,[s(x,{flat:"",bordered:"",class:"cursor-pointer",onClick:r=>c.addProducto(o)},{default:n(()=>[s(Q,{src:`${i.$url}../images/${o.imagen}`,class:"q-mb-xs",style:{height:"120px"}},{default:n(()=>[e("div",O,[e("div",$,l(i.$filters.textUpper(o.nombre)),1),e("div",j,[e("span",null,l(o.stock),1),e("span",J,l(o.precio)+" Bs",1)])])]),_:2},1032,["src"])]),_:2},1032,["onClick"])]))),256))])]),e("div",W,[e("div",A,[s(h,{icon:"add_circle_outline",size:"10px",onClick:c.recoveryReceta,color:"green",dense:"","no-caps":"",label:"Recuperar receta"},null,8,["onClick"]),s(S),s(h,{icon:"delete",size:"10px",color:"red",dense:"",flat:"","no-caps":"",label:"limpiar",onClick:t[3]||(t[3]=o=>{a.productosVentas=[],this.receta_id=null})})]),s(C,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:n(()=>[t[13]||(t[13]=e("thead",null,[e("tr",null,[e("th",null,"Producto"),e("th",null,"Cantidad"),e("th",null,"Precio"),e("th",null,"Subtotal")])],-1)),e("tbody",null,[(u(!0),m(_,null,b(a.productosVentas,(o,r)=>{var y,k;return u(),m("tr",{key:r},[e("td",K,[s(Q,{src:`${i.$url}../images/${(y=o.producto)==null?void 0:y.imagen}`,class:"q-mb-xs",style:{height:"35px",width:"35px"}},null,8,["src"]),e("div",X,[s(N,{name:"delete",color:"red",class:"cursor-pointer",onClick:g=>a.productosVentas.splice(r,1)},null,8,["onClick"]),B(" "+l(o.producto_id)+" "+l(i.$filters.textUpper((k=o.producto)==null?void 0:k.nombre)),1)])]),e("td",Y,[V(e("input",{"onUpdate:modelValue":g=>o.cantidad=g,type:"number",style:{width:"50px"}},null,8,Z),[[w,o.cantidad]])]),e("td",ee,[V(e("input",{"onUpdate:modelValue":g=>o.precio=g,type:"number",style:{width:"50px"},step:"0.01"},null,8,te),[[w,o.precio]])]),e("td",oe,l(o.cantidad*o.precio)+" Bs ",1)])}),128))]),e("tfoot",null,[e("tr",null,[t[12]||(t[12]=e("td",{colspan:"3",class:"text-right"},"Total",-1)),e("td",ie,l(a.productosVentas.reduce((o,r)=>o+r.cantidad*r.precio,0))+" Bs",1)])])]),_:1}),s(h,{label:"Realizar venta",color:"positive",class:"full-width","no-caps":"",loading:a.loading,type:"submit",icon:"add_circle_outline"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1}),s(D,{modelValue:a.ventaDialog,"onUpdate:modelValue":t[10]||(t[10]=o=>a.ventaDialog=o)},{default:n(()=>[s(x,{style:{width:"650px",margin:"0 auto"}},{default:n(()=>[s(v,{class:"q-pb-none row items-center"},{default:n(()=>[t[14]||(t[14]=e("div",{class:"text-h6"},"Nueva venta",-1)),s(S),s(h,{flat:"",round:"",dense:"",icon:"close",onClick:t[4]||(t[4]=o=>a.ventaDialog=!1)})]),_:1}),s(v,null,{default:n(()=>[s(U,{onSubmit:c.submitVenta},{default:n(()=>[e("div",se,[e("div",ae,[s(f,{modelValue:a.venta.nit,"onUpdate:modelValue":[t[5]||(t[5]=o=>a.venta.nit=o),c.searchCliente],outlined:"",dense:"",label:"CI/NIT"},null,8,["modelValue","onUpdate:modelValue"])]),e("div",ne,[s(f,{modelValue:a.venta.nombre,"onUpdate:modelValue":t[6]||(t[6]=o=>a.venta.nombre=o),outlined:"",dense:"",label:"Nombre"},null,8,["modelValue"])]),e("div",le,[s(q,{modelValue:a.venta.tipo_venta,"onUpdate:modelValue":t[7]||(t[7]=o=>a.venta.tipo_venta=o),outlined:"",dense:"",label:"Tipo de venta",options:["Interno","Externo"]},null,8,["modelValue"])]),e("div",de,[s(q,{modelValue:a.venta.tipo_pago,"onUpdate:modelValue":t[8]||(t[8]=o=>a.venta.tipo_pago=o),outlined:"",dense:"",label:"Tipo de pago",options:["Efectivo","QR"]},null,8,["modelValue"])]),e("div",re,[s(C,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:n(()=>[t[18]||(t[18]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Producto"),e("th",null,"Cantidad"),e("th",null,"Precio"),e("th",null,"Subtotal")])],-1)),e("tbody",null,[(u(!0),m(_,null,b(a.productosVentas,(o,r)=>(u(),m("tr",null,[e("td",null,l(o.producto_id),1),e("td",ce,[e("div",pe,l(i.$filters.textUpper(o.producto.nombre)),1)]),e("td",ue,l(o.cantidad),1),e("td",he,l(o.precio)+" Bs ",1),e("td",me,l(o.cantidad*o.precio)+" Bs ",1)]))),256))]),e("tfoot",null,[e("tr",null,[t[15]||(t[15]=e("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),e("td",ge,l(a.productosVentas.reduce((o,r)=>o+r.cantidad*r.precio,0))+" Bs",1)]),e("tr",null,[t[16]||(t[16]=e("td",{style:{padding:"0",margin:"0"},colspan:"3",class:"text-right text-bold"},"Efectivo",-1)),e("td",ve,[e("div",fe,[V(e("input",{"onUpdate:modelValue":t[9]||(t[9]=o=>a.efectivo=o),outlined:"",dense:"",label:"Efectivo",style:{width:"100px"}},null,512),[[w,a.efectivo]])])])]),e("tr",null,[t[17]||(t[17]=e("td",{style:{padding:"0",margin:"0"},colspan:"3",class:"text-right text-bold"},"Cambio",-1)),e("td",be,l(c.cambio),1)])])]),_:1})]),e("div",_e,[s(h,{label:"Realizar venta",color:"positive",class:"full-width","no-caps":"",loading:a.loading,type:"submit"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t[19]||(t[19]=e("div",{id:"myElement",class:"hidden"},null,-1))]),_:1})}var Ee=R(F,[["render",xe]]);export{Ee as default};
