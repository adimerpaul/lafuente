import{_ as T,O as u,Y as k,R as e,Q as t,T as a,$ as V,aC as h,aD as _,U as m,V as i,W as r,aB as C,S as E,J as x,P as v,Z as y,ap as b}from"./index.529007dd.js";import{a as p,d as n,e as f,f as w}from"./format.61289fd6.js";import{h as Q,Q as F}from"./moment.d090e81d.js";import{Q as D}from"./QBtnDropdown.b0e127be.js";import{Q as B}from"./QMarkupTable.e43bcea7.js";import{Q as z}from"./QPage.2ddd2494.js";import{C as g}from"./ClosePopup.0077f79a.js";import{I as A}from"./Imprimir.53616e08.js";import{E as S}from"./Excel.a5e16faf.js";import"./QBtnGroup.a3d8e833.js";import"./_commonjsHelpers.a26ce4be.js";const Y={name:"Ventas",data(){return{ventas:[],venta:{},ventaDialog:!1,fechaInicio:Q().format("YYYY-MM-DD"),fechaFin:Q().format("YYYY-MM-DD"),loading:!1,actionPeriodo:"",gestiones:[],users:[],user:"",filter:"",roles:["Doctor","Enfermera","Administrativo","Secretaria"],columns:[{name:"actions",label:"Acciones",align:"center"},{name:"nombre",label:"Nombre",align:"left",field:"nombre"},{name:"descripcion",label:"Descripci\xF3n",align:"left",field:"descripcion"},{name:"unidad",label:"Unidad",align:"left",field:"unidad"},{name:"precio",label:"Precio",align:"left",field:"precio"},{name:"stock",label:"Stock",align:"left",field:"stock"},{name:"stock_minimo",label:"Stock m\xEDnimo",align:"left",field:"stock_minimo"},{name:"stock_maximo",label:"Stock m\xE1ximo",align:"left",field:"stock_maximo"}]}},mounted(){this.ventasGet(),this.usersGet()},methods:{exportExcel(){let o=[{columns:[{label:"ID",value:"id"},{label:"Fecha",value:"fecha"},{label:"Cliente",value:"cliente.nombre"},{label:"Usuario",value:"user.name"},{label:"Estado",value:"estado"},{label:"Total",value:"total"},{label:"Detalle",value:"detailsText"},{label:"Tipo venta",value:"tipo_venta"}],content:this.ventas}];S.export(o,"Ventas")},usersGet(){this.$axios.get("users").then(o=>{this.users=o.data}).catch(o=>{this.$alert.error(o.response.data.message)})},imprimir(o){A.nota(o)},tipoVentasChange(o){this.$axios.put(`tipoVentasChange/${o}`).then(l=>{this.$alert.success("Tipo de venta cambiado"),this.ventasGet()}).catch(l=>{this.$alert.error(l.response.data.message)})},anular(o){this.$alert.dialog("\xBFEst\xE1 seguro de anular la venta?").onOk(()=>{this.$axios.put(`ventasAnular/${o}`).then(l=>{this.$alert.success("Venta anulada"),this.ventasGet()}).catch(l=>{this.$alert.error(l.response.data.message)})})},ventasGet(){this.loading=!0,this.$axios.get("ventas",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,user:this.user}}).then(o=>{this.ventas=o.data}).catch(o=>{this.$alert.error(o.response.data.message)}).finally(()=>{this.loading=!1})}},computed:{usersTodos(){return[{label:"Todos",value:""},...this.users.map(o=>({label:o.name,value:o.id}))]},totalInternos(){return this.ventas.reduce((o,l)=>l.tipo_venta==="Interno"&&l.estado==="Activo"?o+parseFloat(l.total):o,0)},totalExternos(){return this.ventas.reduce((o,l)=>l.tipo_venta==="Externo"&&l.estado==="Activo"?o+parseFloat(l.total):o,0)}}},q={class:"row"},U={class:"col-12 col-md-4 q-pa-xs"},G={class:"col-12 col-md-4 q-pa-xs"},N={class:"col-12 col-md-4 q-pa-xs"},M={class:"col-12"},P={class:"row"},O={class:"col-12 col-md-2"},$={class:"col-12 col-md-2"},L={class:"col-12 col-md-2"},R={class:"col-12 col-md-2"},J={class:"col-12 col-md-2 text-right"},W={class:"col-12 col-md-2 text-right"},Z={class:"text-bold"},j={style:{"max-width":"200px","wrap-option":"wrap","line-height":"0.9"}};function H(o,l,K,X,c,d){return u(),k(V,null,[e(z,{class:"q-pa-xs"},{default:t(()=>[a("div",q,[a("div",U,[e(h,{flat:"",bordered:""},{default:t(()=>[e(_,{class:"q-pa-none"},{default:t(()=>[e(p,{class:"bg-indigo"},{default:t(()=>[e(n,{avatar:""},{default:t(()=>[e(m,{name:"monetization_on",size:"50px",color:"white"})]),_:1}),e(n,null,{default:t(()=>[e(f,{caption:"",class:"text-white"},{default:t(()=>l[4]||(l[4]=[i("Ventas Interno")])),_:1}),e(f,{class:"text-white text-h4"},{default:t(()=>[i(r(d.totalInternos)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),a("div",G,[e(h,{flat:"",bordered:""},{default:t(()=>[e(_,{class:"q-pa-none"},{default:t(()=>[e(p,{class:"bg-orange"},{default:t(()=>[e(n,{avatar:""},{default:t(()=>[e(m,{name:"monetization_on",size:"50px",color:"white"})]),_:1}),e(n,null,{default:t(()=>[e(f,{caption:"",class:"text-white"},{default:t(()=>l[5]||(l[5]=[i("Ventas Externo")])),_:1}),e(f,{class:"text-white text-h4"},{default:t(()=>[i(r(d.totalExternos)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),a("div",N,[e(h,{flat:"",bordered:""},{default:t(()=>[e(_,{class:"q-pa-none"},{default:t(()=>[e(p,{class:"bg-green"},{default:t(()=>[e(n,{avatar:""},{default:t(()=>[e(m,{name:"monetization_on",size:"50px",color:"white"})]),_:1}),e(n,null,{default:t(()=>[e(f,{caption:"",class:"text-white"},{default:t(()=>l[6]||(l[6]=[i("Ventas Total")])),_:1}),e(f,{class:"text-white text-h4"},{default:t(()=>[i(r(d.totalInternos+d.totalExternos)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),a("div",M,[e(h,{flat:"",bordered:""},{default:t(()=>[e(_,{class:"q-pa-none"},{default:t(()=>[a("div",P,[a("div",O,[e(C,{modelValue:c.fechaInicio,"onUpdate:modelValue":l[0]||(l[0]=s=>c.fechaInicio=s),label:"Fecha inicio",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),a("div",$,[e(C,{modelValue:c.fechaFin,"onUpdate:modelValue":l[1]||(l[1]=s=>c.fechaFin=s),label:"Fecha fin",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),a("div",L,[e(F,{modelValue:c.user,"onUpdate:modelValue":l[2]||(l[2]=s=>c.user=s),options:d.usersTodos,label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),a("div",R,[e(E,{color:"primary",label:"Buscar","no-caps":"",icon:"search",loading:c.loading,onClick:l[3]||(l[3]=s=>d.ventasGet())},null,8,["loading"])]),a("div",J,[e(D,{color:"primary",label:"Exportar","no-caps":""},{default:t(()=>[x((u(),v(p,{clickable:"",onClick:d.exportExcel},{default:t(()=>[e(n,{avatar:""},{default:t(()=>[e(m,{name:"file_download"})]),_:1}),e(n,null,{default:t(()=>l[7]||(l[7]=[i("Excel")])),_:1})]),_:1},8,["onClick"])),[[b],[g]])]),_:1})]),a("div",W,[e(E,{color:"positive",label:"Nueva venta","no-caps":"",icon:"add_circle_outline",loading:c.loading,to:"/ventaNuevo"},null,8,["loading"])])])]),_:1})]),_:1})])]),e(B,{dense:"","wrap-cells":""},{default:t(()=>[l[10]||(l[10]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",null,"Acciones"),a("th",null,"ID"),a("th",null,"Fecha"),a("th",null,"Cliente"),a("th",null,"Usuario"),a("th",null,"Estado"),a("th",null,"Total"),a("th",null,"Detalle"),a("th",null,"Tipo venta")])],-1)),a("tbody",null,[(u(!0),k(V,null,y(c.ventas,(s,ee)=>(u(),k("tr",{key:s.id},[a("td",null,[e(D,{color:"primary",label:"Opciones","no-caps":"",dense:"",size:"10px"},{default:t(()=>[x((u(),v(p,{clickable:"",onClick:I=>d.imprimir(s)},{default:t(()=>[e(n,{avatar:""},{default:t(()=>[e(m,{name:"print"})]),_:1}),e(n,null,{default:t(()=>l[8]||(l[8]=[i("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[b],[g]]),x((u(),v(p,{clickable:"",onClick:I=>d.anular(s.id)},{default:t(()=>[e(n,{avatar:""},{default:t(()=>[e(m,{name:"delete"})]),_:1}),e(n,null,{default:t(()=>l[9]||(l[9]=[i("Anular")])),_:1})]),_:2},1032,["onClick"])),[[b],[g]]),x((u(),v(p,{clickable:"",onClick:I=>d.tipoVentasChange(s.id)},{default:t(()=>[e(n,{avatar:""},{default:t(()=>[e(m,{name:"swap_horiz"})]),_:1}),e(n,null,{default:t(()=>[i("Cambiar a "+r(s.tipo_venta==="Interno"?"Externo":"Interno"),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[b],[g]])]),_:2},1024)]),a("td",null,r(s.id),1),a("td",null,r(s.fecha),1),a("td",null,r(s.cliente.nombre),1),a("td",null,r(s.user.name),1),a("td",null,[e(w,{color:s.estado==="Activo"?"positive":"negative",class:"text-white",dense:""},{default:t(()=>[i(r(s.estado),1)]),_:2},1032,["color"])]),a("td",Z,[i(r(s.total)+" ",1),e(w,{size:"10px",color:s.tipo_pago==="Efectivo"?"green":"blue",class:"text-white",dense:""},{default:t(()=>[i(r(s.tipo_pago.charAt(0)),1)]),_:2},1032,["color"])]),a("td",null,[a("div",j,r(s.detailsText),1)]),a("td",null,[e(w,{color:s.tipo_venta==="Interno"?"indigo":"orange",class:"text-white",dense:""},{default:t(()=>[i(r(s.tipo_venta),1)]),_:2},1032,["color"])])]))),128))])]),_:1})]),_:1}),l[11]||(l[11]=a("div",{id:"myElement",class:"hidden"},null,-1))],64)}var me=T(Y,[["render",H]]);export{me as default};
