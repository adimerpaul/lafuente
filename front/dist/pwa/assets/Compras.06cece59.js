import{_ as V,B as p,L as x,F as e,E as a,G as t,O as Q,aF as _,aG as v,I as f,J as r,H as i,aE as k,Q as b,M as q,x as w,C as F}from"./index.b06572a0.js";import{a as h,b as d,c as m}from"./QMenu.c1e63efd.js";import{Q as D}from"./QSelect.22ca404a.js";import{Q as E}from"./QBtnDropdown.af88a833.js";import{Q as I}from"./QChip.cff6d88d.js";import{Q as A}from"./QMarkupTable.8b056a53.js";import{Q as G}from"./QPage.a459216a.js";import{C as y}from"./ClosePopup.160a1389.js";import{h as B}from"./moment.40bc58bf.js";import{I as Y}from"./Imprimir.2b20819b.js";import{E as M}from"./Excel.a5e16faf.js";import"./selection.4897e411.js";import"./format.2cae61da.js";import"./QBtnGroup.2aca49b6.js";import"./_commonjsHelpers.a26ce4be.js";const U={data(){return{compras:[],fechaInicio:B().format("YYYY-MM-DD"),fechaFin:B().format("YYYY-MM-DD"),user:"",users:[],loading:!1}},mounted(){this.comprasGet(),this.usersGet()},computed:{usersTodos(){return[{label:"Todos",value:""},...this.users.map(o=>({label:o.name,value:o.id}))]},totalCompras(){return this.compras.reduce((o,l)=>l.estado==="Activo"?o+parseFloat(l.total):o,0).toFixed(2)},totalAnuladas(){return this.compras.reduce((o,l)=>l.estado==="Anulado"?o+parseFloat(l.total):o,0).toFixed(2)}},methods:{excel(){const o=[{columns:[{label:"ID",value:"id"},{label:"Fecha",value:l=>`${l.fecha} ${l.hora}`},{label:"Proveedor",value:l=>{var u;return((u=l.proveedor)==null?void 0:u.nombre)||l.nombre||""}},{label:"Usuario",value:l=>{var u;return((u=l.user)==null?void 0:u.name)||""}},{label:"Estado",value:"estado"},{label:"Total (Bs)",value:"total"},{label:"Detalle",value:"detailsText"},{label:"Tipo de pago",value:"tipo_pago"},{label:"Factura",value:"nro_factura"}],content:this.compras}];M.export(o,`Compras_${this.fechaInicio}_a_${this.fechaFin}`)},comprasGet(){this.loading=!0,this.$axios.get("compras",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,user:this.user}}).then(o=>{this.compras=o.data}).catch(o=>{var l,u;this.$alert.error(((u=(l=o.response)==null?void 0:l.data)==null?void 0:u.message)||"Error al obtener compras")}).finally(()=>{this.loading=!1})},usersGet(){this.$axios.get("users").then(o=>{console.log(o.data),this.users=o.data})},imprimir(o){Y.reciboCompra(o)},anular(o){this.$alert.dialog("\xBFAnular esta compra?").onOk(()=>{this.loading=!0,this.$axios.put(`comprasAnular/${o}`).then(()=>{this.$alert.success("Compra anulada"),this.comprasGet()})})}}},P={class:"row"},z={class:"col-12 col-md-4 q-pa-xs"},S={class:"col-12 col-md-4 q-pa-xs"},L={class:"col-12 col-md-4 q-pa-xs"},N={class:"row q-col-gutter-sm q-pa-sm"},O={class:"col-12 col-md-2"},H={class:"col-12 col-md-2"},J={class:"col-12 col-md-2"},$={class:"col-12 col-md-2"},j={class:"col-12 col-md-2"},K={class:"col-12 col-md-2"},R={class:"text-bold"},W={style:{"max-width":"200px","line-height":"1.1"}};function X(o,l,u,Z,n,c){return p(),x(Q,null,[e(G,{class:"q-pa-xs"},{default:a(()=>[t("div",P,[t("div",z,[e(_,{flat:"",bordered:""},{default:a(()=>[e(v,{class:"q-pa-none"},{default:a(()=>[e(h,{class:"bg-green"},{default:a(()=>[e(d,{avatar:""},{default:a(()=>[e(f,{name:"inventory_2",size:"50px",color:"white"})]),_:1}),e(d,null,{default:a(()=>[e(m,{caption:"",class:"text-white"},{default:a(()=>l[4]||(l[4]=[r("Compras Totales")])),_:1}),e(m,{class:"text-white text-h4"},{default:a(()=>[r(i(c.totalCompras)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),t("div",S,[e(_,{flat:"",bordered:""},{default:a(()=>[e(v,{class:"q-pa-none"},{default:a(()=>[e(h,{class:"bg-negative"},{default:a(()=>[e(d,{avatar:""},{default:a(()=>[e(f,{name:"cancel",size:"50px",color:"white"})]),_:1}),e(d,null,{default:a(()=>[e(m,{caption:"",class:"text-white"},{default:a(()=>l[5]||(l[5]=[r("Compras Anuladas")])),_:1}),e(m,{class:"text-white text-h4"},{default:a(()=>[r(i(c.totalAnuladas)+" Bs",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),t("div",L,[e(_,{flat:"",bordered:""},{default:a(()=>[e(v,{class:"q-pa-none"},{default:a(()=>[e(h,{class:"bg-indigo"},{default:a(()=>[e(d,{avatar:""},{default:a(()=>[e(f,{name:"inventory_2",size:"50px",color:"white"})]),_:1}),e(d,null,{default:a(()=>[e(m,{caption:"",class:"text-white"},{default:a(()=>l[6]||(l[6]=[r("Total Compras")])),_:1}),e(m,{class:"text-white text-h4"},{default:a(()=>[r(i(n.compras.length),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),e(_,{flat:"",bordered:"",class:"q-mt-sm"},{default:a(()=>[e(v,{class:"q-pa-none"},{default:a(()=>[t("div",N,[t("div",O,[e(k,{modelValue:n.fechaInicio,"onUpdate:modelValue":l[0]||(l[0]=s=>n.fechaInicio=s),label:"Fecha inicio",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),t("div",H,[e(k,{modelValue:n.fechaFin,"onUpdate:modelValue":l[1]||(l[1]=s=>n.fechaFin=s),label:"Fecha fin",dense:"",outlined:"",type:"date"},null,8,["modelValue"])]),t("div",J,[e(D,{modelValue:n.user,"onUpdate:modelValue":l[2]||(l[2]=s=>n.user=s),options:c.usersTodos,label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),t("div",$,[e(b,{color:"primary",label:"Buscar",icon:"search",onClick:c.comprasGet,loading:n.loading,"no-caps":""},null,8,["onClick","loading"])]),t("div",j,[e(b,{color:"positive",label:"Compra",icon:"add_circle_outline",onClick:l[3]||(l[3]=s=>o.$router.push({name:"compras-create"})),"no-caps":"",loading:n.loading},null,8,["loading"])]),t("div",K,[e(b,{color:"primary",label:"Excel",icon:"file_download",onClick:c.excel,"no-caps":"",loading:n.loading},null,8,["onClick","loading"])])])]),_:1})]),_:1}),e(A,{dense:"","wrap-cells":""},{default:a(()=>[l[9]||(l[9]=t("thead",null,[t("tr",{class:"bg-primary text-white"},[t("th",null,"Acciones"),t("th",null,"ID"),t("th",null,"Fecha"),t("th",null,"Proveedor"),t("th",null,"Usuario"),t("th",null,"Estado"),t("th",null,"Total"),t("th",null,"Detalle"),t("th",null,"Pago")])],-1)),t("tbody",null,[(p(!0),x(Q,null,q(n.compras,s=>{var g,C;return p(),x("tr",{key:s.id},[t("td",null,[e(E,{color:"primary",label:"Opciones","no-caps":"",dense:"",size:"10px"},{default:a(()=>[w((p(),F(h,{clickable:"",onClick:T=>c.imprimir(s)},{default:a(()=>[e(d,{avatar:""},{default:a(()=>[e(f,{name:"print"})]),_:1}),e(d,null,{default:a(()=>l[7]||(l[7]=[r("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[y]]),w((p(),F(h,{clickable:"",onClick:T=>c.anular(s.id)},{default:a(()=>[e(d,{avatar:""},{default:a(()=>[e(f,{name:"delete"})]),_:1}),e(d,null,{default:a(()=>l[8]||(l[8]=[r("Anular")])),_:1})]),_:2},1032,["onClick"])),[[y]])]),_:2},1024)]),t("td",null,i(s.id),1),t("td",null,i(s.fecha)+" "+i(s.hora),1),t("td",null,i((g=s.proveedor)==null?void 0:g.nombre),1),t("td",null,i((C=s.user)==null?void 0:C.name),1),t("td",null,[e(I,{color:s.estado==="Activo"?"positive":"negative",class:"text-white",dense:""},{default:a(()=>[r(i(s.estado),1)]),_:2},1032,["color"])]),t("td",R,i(s.total)+" Bs",1),t("td",null,[t("div",W,i(s.detailsText),1)]),t("td",null,[e(I,{color:s.tipo_pago==="Efectivo"?"green":"blue",class:"text-white",dense:""},{default:a(()=>[r(i(s.tipo_pago),1)]),_:2},1032,["color"])])])}),128))])]),_:1})]),_:1}),l[10]||(l[10]=t("div",{id:"myElement",class:"hidden"},null,-1))],64)}var he=V(U,[["render",X]]);export{he as default};
